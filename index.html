<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="en">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta property="og:type" content="website">
<meta property="og:title" content="Thousandth of Dirt">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="Thousandth of Dirt">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '',
    scheme: 'Mist',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://example.com/"/>





  <title>Thousandth of Dirt</title>
  








<meta name="generator" content="Hexo 5.2.0"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Thousandth of Dirt</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            About
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            Categories
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/12/11/%E8%AE%A9%E5%87%BACPU/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Thousandth of Dirt">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/12/11/%E8%AE%A9%E5%87%BACPU/" itemprop="url">C语言陷阱与技巧第3节，怎样主动让出CPU？如何为C语言函数增加超时检测功能</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-12-11T15:39:49+08:00">
                2020-12-11
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>在Linux C语言程序开发中，这个场景经常出现：进程 A 负责驱动数据采集装置获取数据，进程 B 则负责接收数据并处理。显然，进程 B 需要等待进程 A 将一次数据采集完毕才可以进行下一步工作，因此约定进程 A 采集一次数据完毕时，将 ready 位由 0 置 1，进程 B 监测 ready 位，若发现数据采集完毕，就开始数据处理。</p>
<h2 id="适时地让出-CPU"><a href="#适时地让出-CPU" class="headerlink" title="适时地让出 CPU"></a>适时地让出 CPU</h2><p><strong>如果数据到达之前，进程 B 的工作无法展开</strong>，那进程 B 显然应该时刻监测 ready 位由 0 变为 1，这样才能在数据准备完毕的<strong>第一时间</strong>开始处理数据的工作，这样的需求可以用类似下面这样的C语言代码解决，请看：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span>(!ready);</span><br><span class="line"><span class="comment">/** 下一步工作 */</span></span><br></pre></td></tr></table></figure>

<p>上面的C语言代码使用 while 循环不断检测 ready 位，一旦发现 ready 位被置 1，就立刻进行下一步的工作。这么做似乎绝对不会浪费一点点时间，因此是最好的做法。真的是这样吗？</p>
<p>如果整个系统只有进程 A 和进程 B，这么做的确很好。遗憾的是，如果系统里还有其他进程，上面这种做法就不太合适了，C语言程序遇到 while(!ready); 时，CPU 除了判断 ready 的值，其他什么都不做，这时，整个系统的效率就被拖累了。</p>
<blockquote>
<p>虽然现代操作系统大都拥有“抢占式”的内核，但一般都是通过时间片轮转调度的，在 Linux 中，调度程序的周期一般在 10ms 量级。10ms 的时间，已经够 CPU 处理很多事情了。</p>
</blockquote>
<p>如果数据的处理工作对时间的要求没有苛刻到连 10ms 都不能浪费，那么进程 B 在发现 ready 位没有被置位时，主动的将 CPU 让出给其他进程使用，显然可以提升整个系统的效率。因此，进程 B 等待 ready 置位的 C语言代码，按照下面这样写更加合适，请看：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span>(!ready)</span><br><span class="line">    usleep(<span class="number">10</span>);</span><br><span class="line"><span class="comment">/** 下一步工作 */</span></span><br></pre></td></tr></table></figure>

<p>usleep(10) 可以让进程 B 进入睡眠 10 us（微秒），但在 Linux 中，这么做能够使进程 B 将 CPU 暂时让出，交给操作系统分配给其他进程使用，进程 B 损失一点点时间效率，换来整个系统的效率提升。</p>
<h2 id="超时判断，以及-usleep-的陷阱"><a href="#超时判断，以及-usleep-的陷阱" class="headerlink" title="超时判断，以及 usleep 的陷阱"></a>超时判断，以及 usleep 的陷阱</h2><p>如果进程 A 因为某种原因退出了，那 ready 位永远都不会被置 1，这将导致进程 B 卡死在下面这两行C语言代码：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span>(!ready)</span><br><span class="line">    usleep(<span class="number">10</span>);</span><br></pre></td></tr></table></figure>


<p>避免这种情况的一个好方法是增加<strong>超时判断</strong>，如果超过一段时间，进程 B 发现 ready 仍然没有被置位，就结束等待。要是进程 A 采集数据的周期是 t 秒，那超时时间就可以设置为 t+1 秒，这样就不会在进程 A 意外退出时，进程 B 仍然傻傻的等待 ready 位了。</p>
<p>不过，C语言并没有提供“超时”语法，这就需要程序员自己实现<strong>超时等待</strong>功能了。这种功能也并不难实现，假设超时时间为 5 秒，那相关的C语言代码可以如下实现：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> cnt = <span class="number">50000</span>;</span><br><span class="line"><span class="keyword">while</span>(!ready &amp;&amp; cnt--)</span><br><span class="line">    usleep(<span class="number">100</span>);</span><br></pre></td></tr></table></figure>

<p>使用上面这段C语言代码实现“超时等待”功能足够简单，但是可靠吗？假设 ready 位始终为 0，那上面这几行C语言代码就相当于下面这几行：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> cnt = <span class="number">50000</span>;</span><br><span class="line"><span class="keyword">while</span>(!ready &amp;&amp; cnt--)</span><br><span class="line">    usleep(<span class="number">100</span>);</span><br></pre></td></tr></table></figure>


<p>现在在 main() 函数中测试上述方法的实际睡眠时间，相关C语言代码如下，请看：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/time.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">long</span> <span class="title">get_cur_ms</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">     <span class="class"><span class="keyword">struct</span> <span class="title">timeval</span> <span class="title">tv</span>;</span></span><br><span class="line">     gettimeofday(&amp;tv, <span class="literal">NULL</span>);</span><br><span class="line">     <span class="keyword">return</span> tv.tv_sec*<span class="number">1000</span> + tv.tv_usec/<span class="number">1000</span>;</span><br><span class="line">&#125;   </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">     <span class="keyword">long</span> otime = get_cur_ms();</span><br><span class="line">     <span class="built_in">printf</span>(<span class="string">&quot;cur ms: %ld\n&quot;</span>, otime);</span><br><span class="line"></span><br><span class="line">     <span class="keyword">int</span> cnt = <span class="number">50000</span>;</span><br><span class="line">     <span class="keyword">while</span>(cnt--)</span><br><span class="line">         usleep(<span class="number">100</span>);</span><br><span class="line"></span><br><span class="line">     <span class="built_in">printf</span>(<span class="string">&quot;err ms: %ld\n&quot;</span>, get_cur_ms()-otime);</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://blog.popkx.com/usr/uploads/2019/03/0bdf0a656852bf55d0d623ac397ad4c3.png"><img src="https://blog.popkx.com/usr/uploads/2019/03/0bdf0a656852bf55d0d623ac397ad4c3.png" alt="img"></a><br>上述C语言代码中的 get_cur_ms() 函数可以获得当前时间的毫秒数，在测试“超时”代码之前，先使用 otime 记录当前时间 ms 数，然后在使用“超时”代码后的时间 ms 数减去 otime，就可以得到“超时”代码实际的等待时间了。编译这段C语言代码并执行，得到如下结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># .&#x2F;a.out </span><br><span class="line">cur ms: 1553603227960</span><br><span class="line">err ms: 8406</span><br></pre></td></tr></table></figure>

<p>根据“超时”C语言代码段，预期时间差输出应该是 5 秒，也即 err ms 应该等于 5000，但是输出却是 8406，与预期相差 68%， 这是怎么回事呢？其实查看 usleep 的使用说明就可以得到答案了：<br><a target="_blank" rel="noopener" href="https://blog.popkx.com/usr/uploads/2019/03/7d233974628db2ead2a78e6f2b1e0bd3.png"><img src="https://blog.popkx.com/usr/uploads/2019/03/7d233974628db2ead2a78e6f2b1e0bd3.png" alt="img"></a><br>根据上述文档说明，usleep(usec) 会将线程挂起<strong>至少</strong> usec 秒，而不是严格的 usec 秒，具体多少时间则取决于系统的调度。如果系统比较繁忙，那么 usleep(usec) 的实际睡眠时间可能会被延长，这就解释了预期睡眠 5 秒的C语言代码，最终却睡眠了 8 秒多。</p>
<p>那“超时”代码该怎么写呢？应该明白 gettimeofday() 函数可以获取微秒量级的时间，用于“超时”估计是非常合适的，请看下面的C语言代码：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span>(get_cur_ms()-otime &lt; <span class="number">5000</span>)</span><br><span class="line">        usleep(<span class="number">100</span>); </span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://blog.popkx.com/usr/uploads/2019/03/d57f13464e46db866b00002ad77dd0b2.png"><img src="https://blog.popkx.com/usr/uploads/2019/03/d57f13464e46db866b00002ad77dd0b2.png" alt="img"></a><br>编译上述C语言代码并执行，可以得到如下输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># .&#x2F;a.out </span><br><span class="line">cur ms: 1553608462083</span><br><span class="line">err ms: 5000</span><br></pre></td></tr></table></figure>

<p>可以看出，以上C语言代码的确提供了更加精确的“超时”功能。</p>
<blockquote>
<p>感兴趣的读者可以自己掐秒表测试这两种“超时”C语言代码。</p>
</blockquote>
<h2 id="测试自定义的超时功能"><a href="#测试自定义的超时功能" class="headerlink" title="测试自定义的超时功能"></a>测试自定义的超时功能</h2><p>请看下面的C语言代码：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;                          </span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/time.h&gt;                       </span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;                         </span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;pthread.h&gt;                        </span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> ready = <span class="number">0</span>;                              </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">long</span> <span class="title">get_cur_ms</span><span class="params">()</span>                           </span></span><br><span class="line"><span class="function"></span>&#123;           </span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">timeval</span> <span class="title">tv</span>;</span>                      </span><br><span class="line">    gettimeofday(&amp;tv, <span class="literal">NULL</span>);                </span><br><span class="line">    <span class="keyword">return</span> tv.tv_sec*<span class="number">1000</span> + tv.tv_usec/<span class="number">1000</span>;</span><br><span class="line">&#125;           </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> *<span class="title">thread</span><span class="params">(<span class="keyword">void</span> *p)</span>                       </span></span><br><span class="line"><span class="function"></span>&#123;           </span><br><span class="line">    sleep(<span class="number">3</span>);                               </span><br><span class="line">    ready = <span class="number">1</span>;                              </span><br><span class="line">    <span class="keyword">return</span> <span class="literal">NULL</span>;                            </span><br><span class="line">&#125;           </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span>  </span></span><br><span class="line"><span class="function"></span>&#123;           </span><br><span class="line">    <span class="keyword">pthread_t</span> pid;                          </span><br><span class="line">    pthread_create(&amp;pid, <span class="literal">NULL</span>, thread, <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">long</span> otime = get_cur_ms();              </span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>( !ready &amp;&amp; get_cur_ms()-otime &lt; <span class="number">5000</span>)</span><br><span class="line">        usleep(<span class="number">100</span>);                        </span><br><span class="line">    <span class="keyword">if</span>(get_cur_ms()-otime &gt;= <span class="number">5000</span>)           </span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;time out\n&quot;</span>);               </span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;err ms: %ld\n&quot;</span>, get_cur_ms()-otime);</span><br><span class="line"></span><br><span class="line">   <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://blog.popkx.com/usr/uploads/2019/03/8e15d05d8a56df6d0a1371ea088ae553.png"><img src="https://blog.popkx.com/usr/uploads/2019/03/8e15d05d8a56df6d0a1371ea088ae553.png" alt="img"></a><br>上述C语言代码使用 thread() 线程函数模拟进程 A 对 ready 标志位 3 秒后置 1，main() 函数若 5 秒仍未检测到 ready 被置 1，就提示 “time out”。编译上述C语言代码并执行，得到如下输出:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># gcc t.c -lpthread</span><br><span class="line"># .&#x2F;a.out </span><br><span class="line">err ms: 3000</span><br></pre></td></tr></table></figure>

<p>因为 thread() 函数 3 秒后将 ready 置 1了，所以没有超时。现在将 thread() 中的 sleep(3) 改为 sleep(6)，编译修改后的C语言代码并执行，得到如下输出：<br><a target="_blank" rel="noopener" href="https://blog.popkx.com/usr/uploads/2019/03/13b9c701edb3c097c3be270e6802dea3.png"><img src="https://blog.popkx.com/usr/uploads/2019/03/13b9c701edb3c097c3be270e6802dea3.png" alt="img"></a><br>一切与预期一致。</p>
<h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p>从本节可知，在 Linux C语言程序开发中，需要使用 while 循环不断检查某标志位是否置位时，若对时间的要求不是特别苛刻，可以适当调用 usleep() 函数主动让出 CPU，以提升系统的整体效率。另外，若需要增加超时功能，使用 usleep() 函数误差常常会比较大，应该借助别的方法实现。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/12/11/Sleep%E7%9A%84%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Thousandth of Dirt">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/12/11/Sleep%E7%9A%84%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86/" itemprop="url">Sleep的实现原理</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-12-11T13:25:36+08:00">
                2020-12-11
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ol>
<li>假设现在是 20018-12-03 12:00:00.000，如果我调用一下 Thread.Sleep(1000) ，在 20018-12-03 12:00:01.000 的时候，这个线程会不会被唤醒？</li>
<li>某人的代码中用了一句看似莫明其妙的话：Thread.Sleep(0) 。既然是 Sleep 0 毫秒，那么他跟去掉这句代码相比，有啥区别么？</li>
</ol>
<p>对于第一个问题，答案是：不一定。因为你只是告诉操作系统：在未来的1000毫秒内我不想再参与到CPU竞争。那么1000毫秒过去之后，这时候也许另外一个线程正在使用CPU，那么这时候操作系统是不会重新分配CPU的，直到那个线程挂起或结束；况且，即使这个时候恰巧轮到操作系统进行CPU 分配，那么当前线程也不一定就是总优先级最高的那个，CPU还是可能被其他线程抢占去。<br> Thread.Sleep(0)的作用，就是“让出cpu，会触发操作系统立刻重新进行一次CPU竞争”。竞争的结果也许是当前线程仍然获得CPU控制权，也许会换成别的线程获得CPU控制权。</p>
<h3 id="sleep的底层实现"><a href="#sleep的底层实现" class="headerlink" title="sleep的底层实现"></a>sleep的底层实现</h3><p>sleep()：进程、线程或任务(Linux中不区分进程与线程，都称为task)可以sleep，这会导致它们暂停执行一段时间，直到等待的时间结束才恢复执行或在这段时间内被中断。<br> sleep()在OS中的实现的大概流程：</p>
<ul>
<li>挂起进程（或线程）并修改其运行状态</li>
<li>用sleep()提供的参数来设置一个定时器。</li>
<li>当时间结束，定时器会触发，内核收到中断后修改进程（或线程）的运行状态。例如线程会被标志为就绪而进入就绪队列等待调度。</li>
</ul>
<p>可变定时器(variable timer)一般在硬件层面是通过一个固定的时钟和计数器来实现的，每经过一个时钟周期将计数器递减，当计数器的值为0时产生中断。内核注册一个定时器后可以在一段时间后收到中断。</p>
<p>alarm(time);执行之后告诉内核，让内核在time秒时间之后向该进程发送一个定时信号，然后该进程捕获该信号并处理；<br> pause()函数使该进程暂停让出CPU,但是该函数的暂停是可被中断的睡眠，也就是说收到了中断信号之后处理完毕，再重新执行该进程的时候就直接执行pause()函数之后的语句；注意的是一个进程只能有一个闹钟时间，如果调用alarm()之前已经设置了闹钟时间，那么任何以前的闹钟时间都会被新值所代替。<br> 综上所述，内核的sleep()函数是在挂起原语的基础上利用定时器实现的。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line">#include &lt;signal.h&gt;</span><br><span class="line">#include &lt;unistd.h&gt;</span><br><span class="line">&#x2F;&#x2F;&#x2F;时钟编程 alarm()</span><br><span class="line">void wakeUp()</span><br><span class="line">&#123;</span><br><span class="line">    printf(&quot;please wakeup!!\n&quot;);</span><br><span class="line">&#125;</span><br><span class="line">int main(void)</span><br><span class="line">&#123;</span><br><span class="line">    printf(&quot;you have 4 s sleep!\n&quot;);</span><br><span class="line">    signal(SIGALRM,wakeUp);</span><br><span class="line">    alarm(4);</span><br><span class="line">    &#x2F;&#x2F;将进程挂起</span><br><span class="line">    pause();</span><br><span class="line">    printf(&quot;good morning!\n&quot;);</span><br><span class="line"></span><br><span class="line">    return EXIT_SUCCESS;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/12/11/Exception/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Thousandth of Dirt">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/12/11/Exception/" itemprop="url">RuntimeException和Exception区别</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-12-11T13:21:28+08:00">
                2020-12-11
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h3><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/lulipro/p/7504267.html">1. Java中的异常和处理详解</a></p>
<p>Java设置了异常，旨在鼓励将方法中可能出现的异常告知给使用此方法的程序员（你和我！）。当然了，这种方法是<strong>比较优雅</strong>的，让我们确切的知道是在哪里出了错，并提供了异常捕获。本篇文章主要对Java中的异常进行介绍与区分。<br><img src="https://img-blog.csdnimg.cn/2019061821400045.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2xpeHBqaXRhMzk=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>这是异常的类图。</p>
<p>Throwable是Error和Exception的父类，用来定义所有可以作为异常被抛出来的类。<br>UML图如下：<br><img src="https://img-blog.csdnimg.cn/20190509163805888.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2xpeHBqaXRhMzk=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h3 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h3><h4 id="1-Error和Exception区分："><a href="#1-Error和Exception区分：" class="headerlink" title="1.Error和Exception区分："></a>1.Error和Exception区分：</h4><blockquote>
<p><strong>Error</strong>是编译时错误和系统错误，系统错误在除特殊情况下，都不需要你来关心，基本不会出现。而编译时错误，如果你使用了编译器，那么编译器会提示。</p>
</blockquote>
<blockquote>
<p><strong>Exception</strong>则是可以被抛出的基本类型，我们需要主要关心的也是这个类。<br><strong>Exception</strong>又分为<strong>RunTimeException</strong>和<strong>其他Exception</strong>。</p>
</blockquote>
<h4 id="2-RunTimeException和其他Exception区分："><a href="#2-RunTimeException和其他Exception区分：" class="headerlink" title="2.RunTimeException和其他Exception区分："></a>2.RunTimeException和其他Exception区分：</h4><blockquote>
<p><strong>其他Exception</strong>，受检查异常。可以理解为错误，必须要开发者解决以后才能编译通过，解决的方法有两种，<br>1：throw到上层，<br>2，try-catch处理。</p>
</blockquote>
<blockquote>
<p><strong>RunTimeException</strong>：运行时异常，又称不受检查异常，不受检查！<br>不受检查！！不受检查！！！重要的事情说三遍，因为不受检查，所以在代码中可能会有RunTimeException时Java编译检查时不会告诉你有这个异常，但是在实际运行代码时则会暴露出来，比如经典的1/0，空指针等。如果不处理也会被Java自己处理。</p>
</blockquote>
<h3 id="异常的分类"><a href="#异常的分类" class="headerlink" title="异常的分类"></a>异常的分类</h3><p>Error：一般为底层的不可恢复的类；<br>Exception：分为未检查异常(RuntimeException)和已检查异常(非RuntimeException)。<br>未检查异常是因为程序员没有进行必需要的检查，因为疏忽和错误而引起的错误。几个经典的RunTimeException如下：</p>
<p>1.java.lang.NullPointerException;<br>2.java.lang.ArithmaticException;<br>3.java.lang.ArrayIndexoutofBoundsException</p>
<h4 id="Runtime-Exception："><a href="#Runtime-Exception：" class="headerlink" title="Runtime Exception："></a>Runtime Exception：</h4><p>在定义方法时不需要声明会抛出runtime exception； 在调用这个方法时不需要捕获这个runtime exception； runtime exception是从java.lang.RuntimeException或java.lang.Error类衍生出来的。 例如：nullpointexception，IndexOutOfBoundsException就属于runtime exception</p>
<h4 id="Exception"><a href="#Exception" class="headerlink" title="Exception:"></a>Exception:</h4><p>定义方法时必须声明所有可能会抛出的exception； 在调用这个方法时，必须捕获它的checked exception，不然就得把它的exception传递下去；exception是从java.lang.Exception类衍生出来的。例如：IOException，SQLException就属于Exception</p>
<p>Exception 属于应用程序级别的异常，这类异常必须捕捉,Exception体系包括RuntimeException体系和其他非RuntimeException的体系</p>
<p>RuntimeException 表示系统异常，比较严重，如果出现RuntimeException，那么一定是程序员的错误</p>
<p>什么是unchecked异常?</p>
<p>即RuntimeException（运行时异常）<br>不需要try…catch…或throws 机制去处理的异常</p>
<h3 id="Android异常大全"><a href="#Android异常大全" class="headerlink" title="Android异常大全"></a>Android异常大全</h3><h6 id="java-lang-NullPointerException"><a href="#java-lang-NullPointerException" class="headerlink" title="java.lang.NullPointerException"></a>java.lang.NullPointerException</h6><p>这个异常的解释是 “程序遇上了空指针 “，简单地说就是调用了未经初始化的对象或者是不存在的对象，这个错误经常出现在创建图片，调用数组这些操作中，比如图片未经初始化，或者图片创建时的路径错误等等。对数组操作中出现空指针，即把数组的初始化和数组元素的初始化混淆起来了。数组的初始化是对数组分配需要的空间，而初始化后的数组，其中的元素并没有实例化，依然是空的，所以还需要对每个元素都进行初始化（如果要调用的话）。</p>
<h6 id="java-lang-ClassNotFoundException"><a href="#java-lang-ClassNotFoundException" class="headerlink" title="java.lang.ClassNotFoundException"></a>java.lang.ClassNotFoundException</h6><p>异常的解释是”指定的类不存在”，这里主要考虑一下类的名称和路径是否正确即可</p>
<h6 id="java-lang-ArithmeticException"><a href="#java-lang-ArithmeticException" class="headerlink" title="java.lang.ArithmeticException"></a>java.lang.ArithmeticException</h6><p>这个异常的解释是”数学运算异常”，比如程序中出现了除以零这样的运算就会出这样的异常，对这种异常，大家就要好好检查一下自己程序中涉及到数学运算的地方，公式是不是有不妥了。</p>
<h6 id="java-lang-ArrayIndexOutOfBoundsException"><a href="#java-lang-ArrayIndexOutOfBoundsException" class="headerlink" title="java.lang.ArrayIndexOutOfBoundsException"></a>java.lang.ArrayIndexOutOfBoundsException</h6><p>这个异常的解释是”数组下标越界”，现在程序中大多都有对数组的操作，因此在调用数组的时候一定要认真检查，看自己调用的下标是不是超出了数组的范围，一般来说，显示（即直接用常数当下标）调用不太容易出这样的错，但隐式（即用变量表示下标）调用就经常出错了，还有一种情况，是程序中定义的数组的长度是通过某些特定方法决定的，不是事先声明的，这个时候，最好先查看一下数组的length，以免出现这个异常。</p>
<h6 id="java-lang-IllegalArgumentException"><a href="#java-lang-IllegalArgumentException" class="headerlink" title="java.lang.IllegalArgumentException"></a>java.lang.IllegalArgumentException</h6><p>这个异常的解释是”方法的参数错误”，很多j2me的类库中的方法在一些情况下都会引发这样的错误，比如音量调节方法中的音量参数如果写成负数就会出现这个异常，再比如g.setcolor(int red,int green,int blue)这个方法中的三个值，如果有超过255的也会出现这个异常，因此一旦发现这个异常，我们要做的，就是赶紧去检查一下方法调用中的参数传递是不是出现了错误。</p>
<h6 id="java-lang-IllegalAccessException"><a href="#java-lang-IllegalAccessException" class="headerlink" title="java.lang.IllegalAccessException"></a>java.lang.IllegalAccessException</h6><p>这个异常的解释是”没有访问权限”，当应用程序要调用一个类，但当前的方法即没有对该类的访问权限便会出现这个异常。对程序中用了package的情况下要注意这个异常。<br>其他还有很多异常，我就不一一列举了，我要说明的是，一个合格的程序员，需要对程序中常见的问题有相当的了解和相应的解决办法，否则仅仅停留在写程序而不会改程序的话，会极大影响到自己的开发的。关于异常的全部说明，在api里都可以查阅。</p>
<p>算术异常类：ArithmeticExecption<br>空指针异常类：NullPointerException<br>类型强制转换异常：ClassCastException<br>数组负下标异常：NegativeArrayException<br>数组下标越界异常：ArrayIndexOutOfBoundsException<br>违背安全原则异常：SecturityException<br>文件已结束异常：EOFException<br>文件未找到异常：FileNotFoundException<br>字符串转换为数字异常：NumberFormatException<br>操作数据库异常：SQLException<br>输入输出异常：IOException<br>方法未找到异常：NoSuchMethodException</p>
<h6 id="java-lang-AbstractMethodError"><a href="#java-lang-AbstractMethodError" class="headerlink" title="java.lang.AbstractMethodError"></a>java.lang.AbstractMethodError</h6><p>抽象方法错误。当应用试图调用抽象方法时抛出。</p>
<h6 id="java-lang-AssertionError"><a href="#java-lang-AssertionError" class="headerlink" title="java.lang.AssertionError"></a>java.lang.AssertionError</h6><p>断言错。用来指示一个断言失败的情况。</p>
<h6 id="java-lang-ClassCircularityError"><a href="#java-lang-ClassCircularityError" class="headerlink" title="java.lang.ClassCircularityError"></a>java.lang.ClassCircularityError</h6><p>类循环依赖错误。在初始化一个类时，若检测到类之间循环依赖则抛出该异常。</p>
<h6 id="java-lang-ClassFormatError"><a href="#java-lang-ClassFormatError" class="headerlink" title="java.lang.ClassFormatError"></a>java.lang.ClassFormatError</h6><p>类格式错误。当Java虚拟机试图从一个文件中读取Java类，而检测到该文件的内容不符合类的有效格式时抛出。</p>
<h6 id="java-lang-Error"><a href="#java-lang-Error" class="headerlink" title="java.lang.Error"></a>java.lang.Error</h6><p>错误。是所有错误的基类，用于标识严重的程序运行问题。这些问题通常描述一些不应被应用程序捕获的反常情况。</p>
<h6 id="java-lang-ExceptionInInitializerError"><a href="#java-lang-ExceptionInInitializerError" class="headerlink" title="java.lang.ExceptionInInitializerError"></a>java.lang.ExceptionInInitializerError</h6><p>初始化程序错误。当执行一个类的静态初始化程序的过程中，发生了异常时抛出。静态初始化程序是指直接包含于类中的static语句段。</p>
<h6 id="java-lang-IllegalAccessError"><a href="#java-lang-IllegalAccessError" class="headerlink" title="java.lang.IllegalAccessError"></a>java.lang.IllegalAccessError</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">违法访问错误。当一个应用试图访问、修改某个类的域（Field）或者调用其方法，但是又违反域或方法的可见性声明，则抛出该异常。</span><br><span class="line">1</span><br></pre></td></tr></table></figure>

<h6 id="java-lang-IncompatibleClassChangeError"><a href="#java-lang-IncompatibleClassChangeError" class="headerlink" title="java.lang.IncompatibleClassChangeError"></a>java.lang.IncompatibleClassChangeError</h6><p>不兼容的类变化错误。当正在执行的方法所依赖的类定义发生了不兼容的改变时，抛出该异常。一般在修改了应用中的某些类的声明定义而没有对整个应用重新编译而直接运行的情况下，容易引发该错误。</p>
<h6 id="java-lang-InstantiationError"><a href="#java-lang-InstantiationError" class="headerlink" title="java.lang.InstantiationError"></a>java.lang.InstantiationError</h6><p>实例化错误。当一个应用试图通过Java的new操作符构造一个抽象类或者接口时抛出该异常.</p>
<h6 id="java-lang-InternalError"><a href="#java-lang-InternalError" class="headerlink" title="java.lang.InternalError"></a>java.lang.InternalError</h6><p>内部错误。用于指示Java虚拟机发生了内部错误。</p>
<h6 id="java-lang-LinkageError"><a href="#java-lang-LinkageError" class="headerlink" title="java.lang.LinkageError"></a>java.lang.LinkageError</h6><p>链接错误。该错误及其所有子类指示某个类依赖于另外一些类，在该类编译之后，被依赖的类改变了其类定义而没有重新编译所有的类，进而引发错误的情况。</p>
<h6 id="java-lang-NoClassDefFoundError"><a href="#java-lang-NoClassDefFoundError" class="headerlink" title="java.lang.NoClassDefFoundError"></a>java.lang.NoClassDefFoundError</h6><p>未找到类定义错误。当Java虚拟机或者类装载器试图实例化某个类，而找不到该类的定义时抛出该错误。</p>
<h6 id="java-lang-NoSuchFieldError"><a href="#java-lang-NoSuchFieldError" class="headerlink" title="java.lang.NoSuchFieldError"></a>java.lang.NoSuchFieldError</h6><p>域不存在错误。当应用试图访问或者修改某类的某个域，而该类的定义中没有该域的定义时抛出该错误。</p>
<h6 id="java-lang-NoSuchMethodError"><a href="#java-lang-NoSuchMethodError" class="headerlink" title="java.lang.NoSuchMethodError"></a>java.lang.NoSuchMethodError</h6><p>方法不存在错误。当应用试图调用某类的某个方法，而该类的定义中没有该方法的定义时抛出该错误。</p>
<h6 id="java-lang-OutOfMemoryError"><a href="#java-lang-OutOfMemoryError" class="headerlink" title="java.lang.OutOfMemoryError"></a>java.lang.OutOfMemoryError</h6><p>内存不足错误。当可用内存不足以让Java虚拟机分配给一个对象时抛出该错误。</p>
<h6 id="java-lang-StackOverflowError"><a href="#java-lang-StackOverflowError" class="headerlink" title="java.lang.StackOverflowError"></a>java.lang.StackOverflowError</h6><p>堆栈溢出错误。当一个应用递归调用的层次太深而导致堆栈溢出时抛出该错误。</p>
<h6 id="java-lang-ThreadDeath"><a href="#java-lang-ThreadDeath" class="headerlink" title="java.lang.ThreadDeath"></a>java.lang.ThreadDeath</h6><p>线程结束。当调用Thread类的stop方法时抛出该错误，用于指示线程结束。</p>
<h6 id="java-lang-UnknownError"><a href="#java-lang-UnknownError" class="headerlink" title="java.lang.UnknownError"></a>java.lang.UnknownError</h6><p>未知错误。用于指示Java虚拟机发生了未知严重错误的情况。</p>
<h6 id="java-lang-UnsatisfiedLinkError"><a href="#java-lang-UnsatisfiedLinkError" class="headerlink" title="java.lang.UnsatisfiedLinkError"></a>java.lang.UnsatisfiedLinkError</h6><p>未满足的链接错误。当Java虚拟机未找到某个类的声明为native方法的本机语言定义时抛出。</p>
<h6 id="java-lang-UnsupportedClassVersionError"><a href="#java-lang-UnsupportedClassVersionError" class="headerlink" title="java.lang.UnsupportedClassVersionError"></a>java.lang.UnsupportedClassVersionError</h6><p>不支持的类版本错误。当Java虚拟机试图从读取某个类文件，但是发现该文件的主、次版本号不被当前Java虚拟机支持的时候，抛出该错误。</p>
<h6 id="java-lang-VerifyError"><a href="#java-lang-VerifyError" class="headerlink" title="java.lang.VerifyError"></a>java.lang.VerifyError</h6><p>验证错误。当验证器检测到某个类文件中存在内部不兼容或者安全问题时抛出该错误。</p>
<h6 id="java-lang-VirtualMachineError"><a href="#java-lang-VirtualMachineError" class="headerlink" title="java.lang.VirtualMachineError"></a>java.lang.VirtualMachineError</h6><p>虚拟机错误。用于指示虚拟机被破坏或者继续执行操作所需的资源不足的情况。</p>
<h6 id="java-lang-ArithmeticException-1"><a href="#java-lang-ArithmeticException-1" class="headerlink" title="java.lang.ArithmeticException"></a>java.lang.ArithmeticException</h6><p>算术条件异常。譬如：整数除零等。</p>
<h6 id="java-lang-ArrayIndexOutOfBoundsException-1"><a href="#java-lang-ArrayIndexOutOfBoundsException-1" class="headerlink" title="java.lang.ArrayIndexOutOfBoundsException"></a>java.lang.ArrayIndexOutOfBoundsException</h6><p>数组索引越界异常。当对数组的索引值为负数或大于等于数组大小时抛出。</p>
<h6 id="java-lang-ArrayStoreException"><a href="#java-lang-ArrayStoreException" class="headerlink" title="java.lang.ArrayStoreException"></a>java.lang.ArrayStoreException</h6><p>数组存储异常。当向数组中存放非数组声明类型对象时抛出。</p>
<h6 id="java-lang-ClassCastException"><a href="#java-lang-ClassCastException" class="headerlink" title="java.lang.ClassCastException"></a>java.lang.ClassCastException</h6><p>类造型异常。假设有类A和B（A不是B的父类或子类），O是A的实例，那么当强制将O构造为类B的实例时抛出该异常。该异常经常被称为强制类型转换异常。</p>
<h6 id="java-lang-ClassNotFoundException-1"><a href="#java-lang-ClassNotFoundException-1" class="headerlink" title="java.lang.ClassNotFoundException"></a>java.lang.ClassNotFoundException</h6><p>找不到类异常。当应用试图根据字符串形式的类名构造类，而在遍历 CLASSPAH之后找不到对应名称的class文件时，抛出该异常。</p>
<h6 id="java-lang-CloneNotSupportedException"><a href="#java-lang-CloneNotSupportedException" class="headerlink" title="java.lang.CloneNotSupportedException"></a>java.lang.CloneNotSupportedException</h6><p>不支持克隆异常。当没有实现Cloneable接口或者不支持克隆方法时,调用其clone()方法则抛出该异常。</p>
<h6 id="java-lang-EnumConstantNotPresentException"><a href="#java-lang-EnumConstantNotPresentException" class="headerlink" title="java.lang.EnumConstantNotPresentException"></a>java.lang.EnumConstantNotPresentException</h6><p>枚举常量不存在异常。当应用试图通过名称和枚举类型访问一个枚举对象，但该枚举对象并不包含常量时，抛出该异常。</p>
<h6 id="java-lang-Exception"><a href="#java-lang-Exception" class="headerlink" title="java.lang.Exception"></a>java.lang.Exception</h6><p>根异常。用以描述应用程序希望捕获的情况。</p>
<h6 id="java-lang-IllegalAccessException-1"><a href="#java-lang-IllegalAccessException-1" class="headerlink" title="java.lang.IllegalAccessException"></a>java.lang.IllegalAccessException</h6><p>违法的访问异常。当应用试图通过反射方式创建某个类的实例、访问该类属性、调用该类方法，而当时又无法访问类的、属性的、方法的或构造方法的定义时抛出该异常。</p>
<h6 id="java-lang-IllegalMonitorStateException"><a href="#java-lang-IllegalMonitorStateException" class="headerlink" title="java.lang.IllegalMonitorStateException"></a>java.lang.IllegalMonitorStateException</h6><p>违法的监控状态异常。当某个线程试图等待一个自己并不拥有的对象（O）的监控器或者通知其他线程等待该对象（O）的监控器时，抛出该异常。</p>
<h6 id="java-lang-IllegalStateException"><a href="#java-lang-IllegalStateException" class="headerlink" title="java.lang.IllegalStateException"></a>java.lang.IllegalStateException</h6><p>违法的状态异常。当在Java环境和应用尚未处于某个方法的合法调用状态，而调用了该方法时，抛出该异常。</p>
<h6 id="java-lang-IllegalThreadStateException"><a href="#java-lang-IllegalThreadStateException" class="headerlink" title="java.lang.IllegalThreadStateException"></a>java.lang.IllegalThreadStateException</h6><p>违法的线程状态异常。当县城尚未处于某个方法的合法调用状态，而调用了该方法时，抛出异常。</p>
<h6 id="java-lang-IndexOutOfBoundsException"><a href="#java-lang-IndexOutOfBoundsException" class="headerlink" title="java.lang.IndexOutOfBoundsException"></a>java.lang.IndexOutOfBoundsException</h6><p>索引越界异常。当访问某个序列的索引值小于0或大于等于序列大小时，抛出该异常。</p>
<h6 id="java-lang-InstantiationException"><a href="#java-lang-InstantiationException" class="headerlink" title="java.lang.InstantiationException"></a>java.lang.InstantiationException</h6><p>实例化异常。当试图通过 newInstance()方法创建某个类的实例，而该类是一个抽象类或接口时，抛出该异常。</p>
<h6 id="java-lang-InterruptedException"><a href="#java-lang-InterruptedException" class="headerlink" title="java.lang.InterruptedException"></a>java.lang.InterruptedException</h6><p>被中止异常。当某个线程处于长时间的等待、休眠或其他暂停状态，而此时其他的线程通过Thread的###### interrupt方法终止该线程时抛出该异常。</p>
<h6 id="java-lang-NegativeArraySizeException"><a href="#java-lang-NegativeArraySizeException" class="headerlink" title="java.lang.NegativeArraySizeException"></a>java.lang.NegativeArraySizeException</h6><p>数组大小为负值异常。当使用负数大小值创建数组时抛出该异常。</p>
<h6 id="java-lang-NoSuchFieldException"><a href="#java-lang-NoSuchFieldException" class="headerlink" title="java.lang.NoSuchFieldException"></a>java.lang.NoSuchFieldException</h6><p>属性不存在异常。当访问某个类的不存在的属性时抛出该异常。</p>
<h6 id="java-lang-NoSuchMethodException"><a href="#java-lang-NoSuchMethodException" class="headerlink" title="java.lang.NoSuchMethodException"></a>java.lang.NoSuchMethodException</h6><p>方法不存在异常。当访问某个类的不存在的方法时抛出该异常。</p>
<h6 id="java-lang-NullPointerException-1"><a href="#java-lang-NullPointerException-1" class="headerlink" title="java.lang.NullPointerException"></a>java.lang.NullPointerException</h6><p>空指针异常。当应用试图在要求使用对象的地方使用了 null时，抛出该异常。譬如：调用null对象的实例方法、访问null对象的属性、计算null对象的长度、使用throw语句抛出null等等。</p>
<h6 id="java-lang-NumberFormatException"><a href="#java-lang-NumberFormatException" class="headerlink" title="java.lang.NumberFormatException"></a>java.lang.NumberFormatException</h6><p>数字格式异常。当试图将一个String转换为指定的数字类型，而该字符串确不满足数字类型要求的格式时，抛出该异常。</p>
<h6 id="java-lang-RuntimeException"><a href="#java-lang-RuntimeException" class="headerlink" title="java.lang.RuntimeException"></a>java.lang.RuntimeException</h6><p>运行时异常。是所有 Java虚拟机正常操作期间可以被抛出的异常的父类。</p>
<h6 id="java-lang-SecurityException"><a href="#java-lang-SecurityException" class="headerlink" title="java.lang.SecurityException"></a>java.lang.SecurityException</h6><p>安全异常。由安全管理器抛出，用于指示违反安全情况的异常。</p>
<h6 id="java-lang-StringIndexOutOfBoundsException"><a href="#java-lang-StringIndexOutOfBoundsException" class="headerlink" title="java.lang.StringIndexOutOfBoundsException"></a>java.lang.StringIndexOutOfBoundsException</h6><p>字符串索引越界异常。当使用索引值访问某个字符串中的字符，而该索引值小于0或大于等于序列大小时，抛出该异常。</p>
<h6 id="java-lang-TypeNotPresentException"><a href="#java-lang-TypeNotPresentException" class="headerlink" title="java.lang.TypeNotPresentException"></a>java.lang.TypeNotPresentException</h6><p>类型不存在异常。当应用试图</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/12/09/Spark-%E6%99%AE%E9%80%9A%E6%96%87%E4%BB%B6%E5%A4%9A%E8%B7%AF%E8%BE%93%E5%87%BA/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Thousandth of Dirt">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/12/09/Spark-%E6%99%AE%E9%80%9A%E6%96%87%E4%BB%B6%E5%A4%9A%E8%B7%AF%E8%BE%93%E5%87%BA/" itemprop="url">Spark saveAsHadoopFile 文件多路输出</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-12-09T20:42:25+08:00">
                2020-12-09
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h6 id="RDD-collect-："><a href="#RDD-collect-：" class="headerlink" title="RDD.collect()："></a>RDD.collect()：</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">	&#123;</span><br><span class="line">		&quot;_1&quot;:&quot;a&quot;,</span><br><span class="line">		&quot;_2&quot;:&quot;this is a record&quot;</span><br><span class="line">	&#125;,</span><br><span class="line">	&#123;</span><br><span class="line">		&quot;_1&quot;:&quot;b&quot;,</span><br><span class="line">		&quot;_2&quot;:&quot;this is b record&quot;</span><br><span class="line">	&#125;,</span><br><span class="line">	&#123;</span><br><span class="line">		&quot;_1&quot;:&quot;c&quot;,</span><br><span class="line">		&quot;_2&quot;:&quot;this is c record&quot;</span><br><span class="line">	&#125;,</span><br><span class="line">	&#123;</span><br><span class="line">		&quot;_1&quot;:&quot;e&quot;,</span><br><span class="line">		&quot;_2&quot;:&quot;this is d record&quot;</span><br><span class="line">	&#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<h6 id="自定义多路输出类："><a href="#自定义多路输出类：" class="headerlink" title="自定义多路输出类："></a>自定义多路输出类：</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">import org.apache.hadoop.mapred.lib.MultipleTextOutputFormat;</span><br><span class="line"></span><br><span class="line">public class RDDMultipleTextOutputFormat extends MultipleTextOutputFormat&lt;String, String&gt; &#123;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected String generateFileNameForKeyValue(String key, String value, String name) &#123;</span><br><span class="line"></span><br><span class="line">	</span><br><span class="line">        name &#x3D; key + &quot;&#x2F;&quot; + name;</span><br><span class="line">        return  name; &#x2F;&#x2F; &quot;a&#x2F;part&quot;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h6 id="保存文件（rdd-saveAsHadoopFile）："><a href="#保存文件（rdd-saveAsHadoopFile）：" class="headerlink" title="保存文件（rdd.saveAsHadoopFile）："></a>保存文件（rdd.saveAsHadoopFile）：</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rdd.saveAsHadoopFile(path, String.class, String.class, RDDMultipleTextOutputFormat.class);</span><br></pre></td></tr></table></figure>

<h6 id="输出结果"><a href="#输出结果" class="headerlink" title="输出结果"></a>输出结果</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$hadoop fs -ls &#x2F;user&#x2F;shouyan.li&#x2F;freq&#x2F;</span><br><span class="line">Found 5 items</span><br><span class="line">-rw-rw-r--   3 shouyan.li work          0 2020-12-09 20:27 &#x2F;user&#x2F;shouyan.li&#x2F;freq&#x2F;_SUCCESS</span><br><span class="line">drwxrwxr-x   - shouyan.li work          0 2020-12-09 20:27 &#x2F;user&#x2F;shouyan.li&#x2F;freq&#x2F;a</span><br><span class="line">drwxrwxr-x   - shouyan.li work          0 2020-12-09 20:27 &#x2F;user&#x2F;shouyan.li&#x2F;freq&#x2F;b</span><br><span class="line">drwxrwxr-x   - shouyan.li work          0 2020-12-09 20:27 &#x2F;user&#x2F;shouyan.li&#x2F;freq&#x2F;c</span><br><span class="line">drwxrwxr-x   - shouyan.li work          0 2020-12-09 20:27 &#x2F;user&#x2F;shouyan.li&#x2F;freq&#x2F;e</span><br><span class="line"></span><br><span class="line">$ hadoop fs -ls &#x2F;user&#x2F;shouyan.li&#x2F;freq&#x2F;a</span><br><span class="line">Found 1 items</span><br><span class="line">-rw-rw-r--   3 shouyan.li work         24 2020-12-09 20:27 &#x2F;user&#x2F;shouyan.li&#x2F;freq&#x2F;a&#x2F;part-00000</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/12/09/Spark-%E5%A4%9A%E8%B7%AF%E8%BE%93%E5%87%BA/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Thousandth of Dirt">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/12/09/Spark-%E5%A4%9A%E8%B7%AF%E8%BE%93%E5%87%BA/" itemprop="url">Spark中Dataset Schema分析</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-12-09T16:37:36+08:00">
                2020-12-09
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Spark中Dataset Schema分析</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Console.log(rowstr);</span><br><span class="line">&#123;</span><br><span class="line">	&quot;freq&quot;:1,</span><br><span class="line">	&quot;text&quot;:&quot;a&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ds.schema();</span><br><span class="line">&#123;</span><br><span class="line">	&quot;empty&quot;:false,</span><br><span class="line">	&quot;traversableAgain&quot;:true</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ds.schema().toString();</span><br><span class="line">StructType(</span><br><span class="line">	StructField(freq,LongType,true), </span><br><span class="line">    StructField(text,StringType,true)</span><br><span class="line">)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ds.printSchema();</span><br><span class="line">root</span><br><span class="line"> |-- freq: long (nullable &#x3D; true)</span><br><span class="line"> |-- text: string (nullable &#x3D; true)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">Configuration conf &#x3D; new Configuration();</span><br><span class="line">conf.set(&quot;parquet.write.support.class&quot;, GroupWriteSupport.class.getName());</span><br><span class="line">conf.set(&quot;spark.sql.parquet.writeLegacyFormat&quot;, &quot;false&quot;);</span><br><span class="line">conf.set(&quot;spark.sql.parquet.outputTimestampType&quot;, &quot;INT96&quot;);</span><br><span class="line">conf.set(&quot;parquet.enable.dictionary&quot;, &quot;false&quot;);</span><br><span class="line">conf.set(&quot;parquet.compression&quot;, &quot;snappy&quot;);</span><br><span class="line">MessageType mt &#x3D; new SparkToParquetSchemaConverter(configuration).convert(ds.schema());</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">	&quot;columns&quot;:[</span><br><span class="line">		&#123;</span><br><span class="line">			&quot;maxDefinitionLevel&quot;:1,</span><br><span class="line">			&quot;maxRepetitionLevel&quot;:0,</span><br><span class="line">			&quot;path&quot;:[&quot;freq&quot;],</span><br><span class="line">			&quot;type&quot;:&quot;INT64&quot;,</span><br><span class="line">			&quot;typeLength&quot;:0</span><br><span class="line">		&#125;,</span><br><span class="line">		&#123;</span><br><span class="line">			&quot;maxDefinitionLevel&quot;:1,</span><br><span class="line">			&quot;maxRepetitionLevel&quot;:0,</span><br><span class="line">			&quot;path&quot;:[&quot;text&quot;],</span><br><span class="line">			&quot;type&quot;:&quot;BINARY&quot;,</span><br><span class="line">			&quot;typeLength&quot;:0</span><br><span class="line">		&#125;</span><br><span class="line">	],</span><br><span class="line">	&quot;fieldCount&quot;:2,</span><br><span class="line">	&quot;fields&quot;:[</span><br><span class="line">		&#123;</span><br><span class="line">			&quot;decimalMetadata&quot;:null,</span><br><span class="line">			&quot;id&quot;:null,</span><br><span class="line">			&quot;name&quot;:&quot;freq&quot;,</span><br><span class="line">			&quot;originalType&quot;:null,</span><br><span class="line">			&quot;primitive&quot;:true,</span><br><span class="line">			&quot;primitiveTypeName&quot;:&quot;INT64&quot;,</span><br><span class="line">			&quot;repetition&quot;:&quot;OPTIONAL&quot;,</span><br><span class="line">			&quot;typeLength&quot;:0</span><br><span class="line">		&#125;,</span><br><span class="line">		&#123;</span><br><span class="line">			&quot;decimalMetadata&quot;:null,</span><br><span class="line">			&quot;id&quot;:null,</span><br><span class="line">			&quot;name&quot;:&quot;text&quot;,</span><br><span class="line">			&quot;originalType&quot;:&quot;UTF8&quot;,</span><br><span class="line">			&quot;primitive&quot;:true,</span><br><span class="line">			&quot;primitiveTypeName&quot;:&quot;BINARY&quot;,</span><br><span class="line">			&quot;repetition&quot;:&quot;OPTIONAL&quot;,</span><br><span class="line">			&quot;typeLength&quot;:0</span><br><span class="line">		&#125;</span><br><span class="line">	],</span><br><span class="line">	&quot;id&quot;:null,</span><br><span class="line">	&quot;name&quot;:&quot;spark_schema&quot;,</span><br><span class="line">	&quot;originalType&quot;:null,</span><br><span class="line">	&quot;paths&quot;:[</span><br><span class="line">		[&quot;freq&quot;],</span><br><span class="line">		[&quot;text&quot;]</span><br><span class="line">	],</span><br><span class="line">	&quot;primitive&quot;:false,</span><br><span class="line">	&quot;repetition&quot;:&quot;REPEATED&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">mt.toString();</span><br><span class="line">&quot;message spark_schema &#123;\n  optional int64 freq;\n  optional binary text (UTF8);\n&#125;\n&quot;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/12/08/Spark%E7%AC%94%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Thousandth of Dirt">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/12/08/Spark%E7%AC%94%E8%AE%B0/" itemprop="url">Spark的driver理解和executor理解</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-12-08T17:44:00+08:00">
                2020-12-08
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>如下图，本人觉得这些始终有些抽象</p>
<p><img src="https://img-blog.csdn.net/20181011090802244" alt="img"></p>
<p>看到这样的图，我很想知道driver program在哪里啊，鬼知道？为此我自己研究了一下，网友大多都说是对的有不同想法的请评论</p>
<h3 id="二、现在我有三台电脑-分别是"><a href="#二、现在我有三台电脑-分别是" class="headerlink" title="二、现在我有三台电脑 分别是"></a>二、现在我有三台电脑 分别是</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">192.168.10.82 –&gt;bigdata01.hzjs.co </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">192.168.10.83 –&gt;bigdata02.hzjs.co </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">192.168.10.84 –&gt;bigdata03.hzjs.co </span><br></pre></td></tr></table></figure>

<p>集群的slaves文件配置如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">bigdata01.hzjs.co</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">bigdata02.hzjs.co</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">bigdata03.hzjs.co</span><br></pre></td></tr></table></figure>

<p>那么这三台机器都是worker节点，本集群是一个完全分布式的集群经过测试，我使用# ./start-all.sh ，那么你在哪台机器上执行的哪台机器就是7071 Master主节点进程的位置，我现在在192.168.10.84使用./start-all.sh </p>
<p>那么就会这样</p>
<p><img src="https://img-blog.csdn.net/2018101109111487" alt="img"></p>
<h3 id="三、那么我们来看看local模式下"><a href="#三、那么我们来看看local模式下" class="headerlink" title="三、那么我们来看看local模式下"></a>三、那么我们来看看local模式下</h3><p><img src="https://img-blog.csdn.net/20181011091217842" alt="img"></p>
<p>现在假设我在192.168.10.84上执行了 bin]# spark-shell 那么就会在192.168.10.84产生一个SparkContext，此时84就是driver,其他woker节点（三台都是）就是产生executor的机器。如图 </p>
<p><img src="https://img-blog.csdn.net/20181011091449914" alt="img"></p>
<p>现在假设我在192.168.10.83上执行了 bin]# spark-shell 那么就会在192.168.10.83产生一个SparkContext，此时83就是driver,其他woker节点（三台都是）就是产生executor的机器。如图</p>
<p><img src="https://img-blog.csdn.net/20181011091610529" alt="img"></p>
<p><strong>总结：</strong>在local模式下  驱动程序driver就是执行了一个Spark Application的main函数和创建Spark Context的进程，它包含了这个application的全部代码。（在那台机器运行了应用的全部代码创建了sparkContext就是drive,也可以说是你提交代码运行的那台机器）</p>
<h3 id="四、那么看看cluster模式下"><a href="#四、那么看看cluster模式下" class="headerlink" title="四、那么看看cluster模式下"></a>四、那么看看cluster模式下</h3><p><img src="https://img-blog.csdn.net/20181011091756661" alt="img"></p>
<p>现在假设我在192.168.10.83上执行了 bin]# spark-shell 192.168.10.84:7077 那么就会在192.168.10.84产生一个SparkContext，此时84就是driver,其他woker节点（三台都是）就是产生executor的机器。这里直接指定了主节点driver是哪台机器:如图</p>
<p><img src="https://img-blog.csdn.net/2018101109193384" alt="img"></p>
<h3 id="五、如果driver有多个，那么按照上面的规则，去判断具体在哪里"><a href="#五、如果driver有多个，那么按照上面的规则，去判断具体在哪里" class="headerlink" title="五、如果driver有多个，那么按照上面的规则，去判断具体在哪里"></a>五、如果driver有多个，那么按照上面的规则，去判断具体在哪里</h3><p><img src="https://img-blog.csdn.net/20181011092039209" alt="img"></p>
<p><strong>Driver:</strong> 使用Driver这一概念的分布式框架有很多，比如hive,Spark中的Driver即运行Application的main()函数，并且创建SparkContext，创建SparkContext的目的是为了准备Spark应用程序的运行环境，在Spark中由SparkContext负责与ClusterManager通讯，进行资源的申请，任务的分配和监控等。当Executor部分运行完毕后，Driver同时负责将SaprkContext关闭，通常SparkContext代表Driver.</p>
<p><img src="https://img-blog.csdn.net/20181011092216651" alt="img"></p>
<p>上面红色框框都属于Driver，运行在Driver端，中间没有框住的部分属于Executor，运行的每个ExecutorBackend进程中。println(pcase.count())collect方法是Spark中Action操作，负责job的触发，因为这里有个sc.runJob（）方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">def count(): Long &#x3D; sc.runJob(this, Utils.getIteratorSize _).sum</span><br></pre></td></tr></table></figure>

<p>hbaseRDD.map(）属于Transformation操作。</p>
<p><strong>总结：</strong>Spark Application的main方法（于SparkContext相关的代码）运行在Driver上，当用于计算的RDD触发Action动作之后，会提交Job，那么RDD就会向前追溯每一个transformation操作，直到初始的RDD开始，这之间的代码运行在Executor。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/12/07/%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Thousandth of Dirt">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/12/07/%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/" itemprop="url">推荐系统的112条实战经验</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-12-07T13:23:00+08:00">
                2020-12-07
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/" itemprop="url" rel="index">
                    <span itemprop="name">推荐系统</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p> <strong>阿里巴巴</strong></p>
<p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247507509&idx=1&sn=5f0db1f772d6d8c39016c54318bbc1b1&chksm=fbd76c59cca0e54f82bc64bd1480e1bf36eb1d3323eaf0ce48c9362cdf2665aaafde8c1943a2&scene=21#wechat_redirect">阿里新一代Rank技术</a></p>
<p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247513875&idx=1&sn=75f718e9c7a27e37a753bd7d7e3c1fd1&chksm=fbd7057fcca08c690d7b5aab77ff92a374e8f88b722815c421e0d69d1fecad73fec888969a7c&scene=21#wechat_redirect">信息流推荐的用户增长机制</a></p>
<p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247493262&idx=1&sn=c5c2b9827c5de1d1311673523c96e3e7&chksm=fbd754e2cca0ddf47163df7559a20bb85a45633ecdc57f168874819225dffb4db19449c00cdc&scene=21#wechat_redirect">推荐系统走向下一阶段最重要的三个问题</a></p>
<p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247509261&idx=1&sn=17a4b327f46ea40bdf4f7481f8739311&chksm=fbd71761cca09e778f3e05860d2e1333c0ba9e32c6854f1040991478f5965262ef1a0f849b4c&scene=21#wechat_redirect">阿里深度召回模型实践</a></p>
<p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247509060&idx=1&sn=be61e643a3de80d8b0bd028cdb5b6827&chksm=fbd71628cca09f3e637db58ce5fc43254fa18ad16779cd6eaf6f1c2d70bbf9e787b420d4116e&scene=21#wechat_redirect">动态网络表征学习在推荐领域的创新与实践</a></p>
<p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247508674&idx=1&sn=098ce77e2947f6e7bb28e56f320d7633&chksm=fbd710aecca099b8e4facf74dc0de9c6023d022c701d012e181c6286295c7578601b5cf78979&scene=21#wechat_redirect">阿里强化学习重排实践</a></p>
<p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247507741&idx=2&sn=7d147d3db65d445cd6e17fd943643ebf&chksm=fbd76d71cca0e467a1d6add9d396f1722534d13c9a6c7bacb644c92105f5830bb04a240360ee&scene=21#wechat_redirect">阿里跨域点击率预估混合兴趣模型</a></p>
<p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247507022&idx=1&sn=aa4a99562a274b5fd07e5f987a5dc807&chksm=fbd76e22cca0e734f4bc319ec3b908b9b3f200bda80e20b8f65836aac4445bc6a14675aa174e&scene=21#wechat_redirect">深度树匹配技术演进：TDM-&gt;JTM-&gt;BSAT</a></p>
<p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247495660&idx=1&sn=21a5b7e811d104162609d5fef993be79&chksm=fbd75d80cca0d496995ab1135ceb4734b90553a8fd82f4c970ed48212f3d0abd98f58e4e0864&scene=21#wechat_redirect">阿里新一代算法 JTM：如何优化大规模推荐？</a></p>
<p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247492994&idx=1&sn=6a787521ad85f37339f880bba0cc5d63&chksm=fbd757eecca0def8ac32a1c60f49ec933096833b5b55860074fd5d305499adc85d9f833fa333&scene=21#wechat_redirect">深度树检索技术（TDM）及应用框架的探索实践</a></p>
<p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247506153&idx=1&sn=6ce4840ec9642deb8e1c97efdc727390&chksm=fbd76a85cca0e393c44815b55af12ceca91546d32b5aa6b6340cfb3bb4dbed94d88c5f741cb0&scene=21#wechat_redirect">阿里飞猪个性化推荐：召回篇</a></p>
<p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247505774&idx=1&sn=63efc686d3dda67fa4631e5550560476&chksm=fbd76502cca0ec141440482e048196119101abd0a56dd5dba7c9a18f46ba8f0358e3a458408b&scene=21#wechat_redirect">面向下一代的粗排排序系统COLD</a></p>
<p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247504918&idx=1&sn=d4cb633276121dc4f09329cf9d231539&chksm=fbd7667acca0ef6cc9d0f21d309b5b28b15f0452f43d33055a1b9562a9519ad36c032ab961f0&scene=21#wechat_redirect">EdgeRec：边缘计算在淘宝推荐系统中的大规模应用</a></p>
<p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247504657&idx=1&sn=cdc744687502d33c5481aef9aad36618&chksm=fbd7617dcca0e86be7f56b15680c0bb97c2b16d2ac07f71ce251ec2f7dbdbb7e79f3d1747ff6&scene=21#wechat_redirect">阿里飞猪旅行场景下的个性化营销平台揭秘</a></p>
<p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247498610&idx=1&sn=803bff13e7f663a63358ffef96b4525e&chksm=fbd7491ecca0c008f45e48180991ff7f2ccb70b6640ea9d9534c9cb6c2ddc4346bc848c4a3f3&scene=21#wechat_redirect">深度学习在阿里B2B电商推荐系统中的实践</a></p>
<p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247497190&idx=1&sn=c210c40cd365312038c5248752f9e187&chksm=fbd7478acca0ce9c3848d2e699ee4193b9cf08473a3f700d04f8514fa247594cded254aee600&scene=21#wechat_redirect">融合Matching与Ranking的个性化CTR预估模型</a></p>
<p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247496080&idx=1&sn=70f79a37a6000965fa96bccf893b9c40&chksm=fbd743fccca0caeadb59820801597c51353b0a4ba080d2caf66eccb6644102c2fe674ffcb378&scene=21#wechat_redirect">阿里妈妈点击率预估中的长期兴趣建模</a></p>
<p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247495786&idx=1&sn=da7f3edb91280bc37dbf276e74cfecba&chksm=fbd74206cca0cb10d871e9af5e07a7f0427b7483dad6bd770e926b7622f31b0d4b1800e9bd15&scene=21#wechat_redirect">知识结构化在阿里小蜜中的应用</a></p>
<p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247494398&idx=1&sn=cd08a71c4a7ec9a2d81107603fc4c437&chksm=fbd75892cca0d184585075b3315fe0386d37c174995a5a4b27e02db4117a13897678dbcb52ed&scene=21#wechat_redirect">UC 信息流推荐模型在多目标和模型优化方面的进展</a></p>
<p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247494295&idx=1&sn=1218bfa026994967939fa676ed7dd5f9&chksm=fbd758fbcca0d1ede59b225e98add36cae74e9fd3006d42a054c73aaa4a87c75ef46684b9733&scene=21#wechat_redirect">UC 国际信息流推荐中的多语言内容理解</a></p>
<p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247493952&idx=1&sn=f32e43f0e834d12649a3a6272b85ede0&chksm=fbd75b2ccca0d23a224032d999dd52ca3fa53529abf78c2cf3d4f5e9d52ef3a691bcf76bbdd1&scene=21#wechat_redirect">浅谈 UC 国际信息流推荐</a></p>
<p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247492047&idx=1&sn=7db1f1eaadfdac75c5a0ae0e3a7beea1&chksm=fbd753a3cca0dab5fe09c091fb36c0ae9ba9ae83af38593d333bbdf61d97ee137b1577611ec0&scene=21#wechat_redirect">阿里零售通智能导购推荐技术实践</a></p>
<p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247486538&idx=1&sn=32498d028a74dce05ffa4a4eee66e4b5&chksm=fbd4be26cca33730d988a9bd19e5bcd8034fc3388ff468853bfcf5367a4dc446c1ffcff355f8&scene=21#wechat_redirect">饿了么推荐算法演进及在线学习实践</a></p>
<p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247486253&idx=1&sn=5730d5ab24b87a5985ffa5ff10d34c79&chksm=fbd4b941cca330577e3755aea84d9026aca36a55490e7f71c447d613fca0ba5be77c00067490&scene=21#wechat_redirect">外卖推荐算法中有哪些机制与手段？</a></p>
<p> <strong>腾讯</strong></p>
<p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247509016&idx=1&sn=aa4c859d268ca02ff869d0930f154463&chksm=fbd71674cca09f62c62bcc8fa9704df9d041c2c5271bdf4eb4bb9cf7e12bb407469e07868017&scene=21#wechat_redirect">Angel：深度学习在腾讯广告推荐系统中的实践</a></p>
<p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247511450&idx=2&sn=57ce9b8d1493fa72f4255dc9b0b866f2&chksm=fbd71ff6cca096e0f798537bcb9e75b88dd777013b7a9fc94b42fa5e7f7368347fb2c566643d&scene=21#wechat_redirect">如何提升微信看一看推荐混排的长期收益？</a></p>
<p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247495622&idx=1&sn=3d229e34dfe061b61bb47b4677def6a0&chksm=fbd75daacca0d4bc83d02b78b7d7c8485521eba07a03553db52ba039f3d948835f3d750a301e&scene=21#wechat_redirect">腾讯信息流内容理解技术实践</a></p>
<p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247495507&idx=1&sn=a1e0cf988d2e366be58faf1110e4d885&chksm=fbd75d3fcca0d429b33c5a49053dd99a03e603b3230e950d0109f3c9dbe7ede21e1fa2a86752&scene=21#wechat_redirect">RALM: 实时 Look-alike 算法在微信看一看中的应用</a></p>
<p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247487358&idx=2&sn=cb34ecfd9007f7d5e8ab1666d28ae6a3&chksm=fbd4bd12cca33404ad13012093854135de2dbe4a120afa1b8fdc5813bff3344d76cd673dcaa2&scene=21#wechat_redirect">Yoo视频底层页推荐系统从0到1的实践</a></p>
<p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247503484&idx=2&sn=e2a2cdd3a517ab09e903e69ccb1e9f94&chksm=fbd77c10cca0f50642dde47439ed919aa2e61b7ff57bc4cbaacc3acaac3c620a1ed6f92684ab&scene=21#wechat_redirect">微信”看一看”多模型内容策略与召回</a></p>
<p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247504009&idx=2&sn=c3d07faaf34416790456eac5be094049&chksm=fbd762e5cca0ebf33eb7f3de1f9c1539ef5bf9fd7c8196bb85a9012ac7472f9c197b80ef8d56&scene=21#wechat_redirect">微信”看一看”个性化推荐：排序篇</a></p>
<p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247504409&idx=2&sn=69becfabe9fc59774781b7193655c765&chksm=fbd76075cca0e963b64387d7544990b9c2edc4340c43c5b908809f52bc99d649858c7da78866&scene=21#wechat_redirect">微信”看一看”内容理解与推荐</a></p>
<p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247503968&idx=1&sn=d8fac671af39a87c9a74fb1aff327e41&chksm=fbd7620ccca0eb1aab16ab0e7d06e9c8975749808ca8d1191b442458280ea227b8ce4d90d865&scene=21#wechat_redirect">推荐系统 Embedding 技术实践总结</a></p>
<p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247495039&idx=1&sn=35905df6cd4ef33d2ce505d284d3c8ad&chksm=fbd75f13cca0d605c17bf7a8b3b899b7798a590008625fcffbf00d77c2451249bbdc086d6b18&scene=21#wechat_redirect">推荐系统中模型训练及使用流程的标准化</a></p>
<blockquote>
<p><strong>京东</strong></p>
</blockquote>
<p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247492901&idx=1&sn=e0241e72bb057ed300fef994721a2a3b&chksm=fbd75749cca0de5f029b880bbe53914dfd789452d35cde78097f00a75f789f2508e452bf1805&scene=21#wechat_redirect">京东电商推荐系统实践</a></p>
<p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247484272&idx=1&sn=4efe082488a823710044688fa4bb0c2d&chksm=fbd4b11ccca3380ac58d9697f766ac394496e84236be21e0301a7808b43a9bdd8e408cefbcc5&scene=21#wechat_redirect">京东购物在微信等场景下的算法应用实践</a></p>
<p> <strong>微博</strong></p>
<p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247505895&idx=1&sn=d449cd607a21e01805db245be8289de6&chksm=fbd7658bcca0ec9d27eb71a01e8b08711802f59cb0c04aa6059eb0d60b895212de8b8e0b5a38&scene=21#wechat_redirect">微博推荐算法实践与机器学习平台演进</a></p>
<p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247496280&idx=1&sn=870b45e0f9bfda51a093ceabb9b51df2&chksm=fbd74034cca0c922893be32402905954f87d98ffa55aa879b45d9974870f29e15e2a1f5a1429&scene=21#wechat_redirect">NLP 技术在微博 feed 流中的应用</a></p>
<p> <strong>Hulu</strong></p>
<p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247491883&idx=1&sn=9a28cb03a2e34ec380cd5ff789b8f48d&chksm=fbd75347cca0da51e1257f4de6824e77546f3eeb1e78090cd11ec71841f31cc4cf8562ab3151&scene=21#wechat_redirect">基于行列式点过程的推荐多样性提升算法</a></p>
<p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247488030&idx=1&sn=03c7488018b9a6488d5fa01a4057cf3c&chksm=fbd4a072cca32964e7a847bca7e0aecd4bcdacfbf2a47be8f646257f4fd1808cb8472869c6d4&scene=21#wechat_redirect">从推荐推理奔向未来AI</a></p>
<p> <strong>第四范式</strong></p>
<p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247508574&idx=1&sn=c6c97956d6184d02b4c1a80b37c40f49&chksm=fbd71032cca099244958d11f79c848cccc7cb8d709630848788dfa59093df466cb0e1abfae16&scene=21#wechat_redirect">全新的深度模型在推荐系统中的应用</a></p>
<p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247507062&idx=1&sn=bbc69fc689ae1e641856455b047a52cf&chksm=fbd76e1acca0e70cab30c3709e1cda4ca10f5e82d61f15c07b68b16882e2e795fafef483ebe8&scene=21#wechat_redirect">推荐系统架构治理</a></p>
<p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247506671&idx=1&sn=31d5a7736c6e5c7c000539c2968db26f&chksm=fbd76883cca0e195a1e5870594dd909408fed909caa16c188751b8d281a10f590a32476eed06&scene=21#wechat_redirect">基于Spark的大规模推荐系统特征工程</a></p>
<p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247496107&idx=1&sn=9b04539283fcb1f5922d75fb6d366dfc&chksm=fbd743c7cca0cad16e5d41c3c1d7b33144d1ad2a7a644b708909e41d4d9e4923a445d4918e4b&scene=21#wechat_redirect">自动特征工程在推荐系统中的研究</a></p>
<p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247499510&idx=1&sn=e4fd68b0694c090dde8ddf1f763a33c8&chksm=fbd74c9acca0c58cba9f28f94707698eafa3a18500b5d06f6468d8a9ac9f187af75bf26e1a14&scene=21#wechat_redirect">分布式机器学习框架与高维实时推荐系统</a></p>
<p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247493934&idx=1&sn=9b58f070854bf02139d9e157ed955c14&chksm=fbd75b42cca0d254c73b2511f324b3474649fc106dc46b321326d93446feeae8cd04d3ac58f1&scene=21#wechat_redirect">推荐系统应该如何保障推荐的多样性？</a></p>
<p> <strong>网易</strong></p>
<p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247512229&idx=1&sn=fe8430b49e6d5fd73e0f9c5cd9d0aaf6&chksm=fbd702c9cca08bdf665cb5628d380e25073dd18366372ff75243f0d9491760f6030a10aebc01&scene=21#wechat_redirect">网易云音乐推荐中的用户行为序列深度建模</a></p>
<p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247509607&idx=1&sn=341212c60824f8c636ee7e8b64a63d62&chksm=fbd7140bcca09d1d52dfb1c10c180feffe3641d2611b46497f08f9722a66cbd6b08436013be4&scene=21#wechat_redirect">“全能选手”召回表征算法实践</a></p>
<p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247508638&idx=1&sn=97aa5c7ee4a7981942f40eed91853645&chksm=fbd710f2cca099e45307f0622d243ba543164c14131bbc8cb5a410b4a8ea974f9e1562b34cde&scene=21#wechat_redirect">Embedding在网易严选搜索推荐中的应用</a></p>
<p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247491955&idx=1&sn=8d6258dd5330a86608191088ec5444a2&chksm=fbd7531fcca0da0945008445177aaaf07b72b61e990fd847e36a8f516eed0f0c93123409dddd&scene=21#wechat_redirect">网易新闻推荐：深度学习排序系统及模型</a></p>
<p> <strong>汽车之家</strong></p>
<p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247497757&idx=1&sn=fe521ea5a746be9ba0aa208506d716b8&chksm=fbd74a71cca0c3676f2681bb7917a12e77562d2c5b3d1e5def4a3eac3fc40bd57e12ef2548e5&scene=21#wechat_redirect">汽车之家推荐系统排序算法迭代之路</a></p>
<blockquote>
<p><strong>58同城</strong></p>
</blockquote>
<p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247512153&idx=2&sn=6cc47aea1e33a787bb80f470d80334f0&chksm=fbd70235cca08b23a96c732096c549bd3ec57626a8f49c782caf22ce25a9f2dfb34b97108bb1&scene=21#wechat_redirect">58同镇下沉市场中的推荐技术实践</a></p>
<p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247508695&idx=1&sn=289aae29d0f912a40c459a458c015157&chksm=fbd710bbcca099ad287709a4b59c7df4a90a040a3010d9652738d290f8948500bd2b2cbdd8e0&scene=21#wechat_redirect">多样性算法在58部落的实践和思考</a></p>
<p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247501599&idx=1&sn=10c0eaa021ef4d7b39a82819bf4b0f66&chksm=fbd77573cca0fc658535625c70a550c297d10d8efcf6ca5640851d76e4cb0b051a9f5f6da62e&scene=21#wechat_redirect">Embedding技术在房产推荐中的应用</a></p>
<p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247502918&idx=1&sn=b461d08b22a9fd8ca2e711bb501b7d7a&chksm=fbd77e2acca0f73ccb2e2dad23ce817a968a9d83fcb0f5c8edda7d6566e77c2ff8bdcd1145a7&scene=21#wechat_redirect">跨域推荐技术在58部落内容社区的实践</a></p>
<p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247501908&idx=1&sn=2478b53f5a28eb4002bbfc9bef62001e&chksm=fbd77a38cca0f32ed9b04e6a2b38c3ce08c47f126863b1dafedefa5aa4d662d25d5537c384e2&scene=21#wechat_redirect">深度召回在招聘推荐中的挑战和实践</a></p>
<p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247506940&idx=2&sn=df6d88efa9f45dc7e2e4592018979692&chksm=fbd76990cca0e08637035afb74fb94cfaec3250c81c8744f41ac6be316d2bee96db16c9fc56c&scene=21#wechat_redirect">深度学习在商业排序的应用实践</a></p>
<p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247506415&idx=2&sn=8daf7925271e76eaf25e4da78a3c1c59&chksm=fbd76b83cca0e29503632cf52ead2b26f62b5aa331ff6030f5fa675b008906e0d51a73ae9cbd&scene=21#wechat_redirect">本地服务场景下的流量分发算法实践</a></p>
<p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247495381&idx=1&sn=4dfd39fe16a402ffef8e32235aa36b21&chksm=fbd75cb9cca0d5af552d9958a3a08690d2767a3f0165537108231bff157fbaf28bd45760ea6b&scene=21#wechat_redirect">如何从 0 到 1 构建个性化推荐？</a></p>
<p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247504377&idx=1&sn=7ca002dd3bfd00a14c93a519b3765a04&chksm=fbd76395cca0ea83b55807543fde6e8fd7879af67d5a4079365493669752cdff06fac5d632c5&scene=21#wechat_redirect">多业务融合推荐策略实践与思考</a></p>
<p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247487523&idx=1&sn=cfe857dd30ba6e59e8a692d68e7ad967&chksm=fbd4a24fcca32b591548023b6a9a6d21b3d758c67912938ac1c78a18f1d0f8ec63cd6593978f&scene=21#wechat_redirect">连接效率优化实践</a></p>
<p> <strong>滴滴</strong></p>
<p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247493807&idx=2&sn=61c5284f22c11a19030bb174bb61f4af&chksm=fbd75ac3cca0d3d580dfbd24ddd9e9dc5c03a01c827efa5bb3e0797e2366fcd2d84c7f2720ab&scene=21#wechat_redirect">浅谈滴滴派单算法</a></p>
<p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247499525&idx=1&sn=638746fcd82ed8ebadb947c5848d8363&chksm=fbd74d69cca0c47fe102231f40b946c7bb0ae968c44061592bf161eb722f6fa71ee6a40b8fdb&scene=21#wechat_redirect">Contextual Bandits 算法在推荐场景中的应用</a></p>
<blockquote>
<p><strong>爱奇艺</strong></p>
</blockquote>
<p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247511245&idx=2&sn=06e8909f8955594394daef5c43f1b538&chksm=fbd71ea1cca097b7373fa24f9d398b58747ef06c408bd798c1995a37a11132e66809306a2ba0&scene=21#wechat_redirect">TF Ranking框架在爱奇艺海外推荐的实践与应用</a></p>
<p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247497579&idx=2&sn=c3ec951aeb5a1a8211826dbd636aee29&chksm=fbd74507cca0cc11226ab3dedc8973d137ceb2123ddd25990a85362161bd00b72ebc2e6d7638&scene=21#wechat_redirect">双DNN排序模型：在线知识蒸馏在爱奇艺推荐的实践</a></p>
<p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247487111&idx=1&sn=0466151a7745795694ee6b66838ef263&chksm=fbd4bcebcca335fd6038ab853b9a73ce1147c953594df2aea6fd1c1db013191086f4c656f5d2&scene=21#wechat_redirect">爱奇艺搜索排序模型迭代之路</a></p>
<p> <strong>携程</strong></p>
<p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247499139&idx=1&sn=c187e0108e9bd55b69e48d0c8de1887d&chksm=fbd74fefcca0c6f9290da7221b0d4b02a1d6a84913cf4950052b2050cd73e52b906d489f824e&scene=21#wechat_redirect">Bandit算法在携程推荐系统中的应用与实践</a></p>
<p> <strong>微众银行</strong></p>
<p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247501356&idx=1&sn=b20af0897367aebb8ca0e53194a68fe8&chksm=fbd77440cca0fd5653e3683ddafff1a67da067cc6726af4e58be75eb8c1ab0a1dfa1b563750b&scene=21#wechat_redirect">微众银行在联邦推荐算法上的探索及应用</a></p>
<p> <strong>花椒直播</strong></p>
<p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247498637&idx=1&sn=a91d76109129fa42e5910c2e2b5f68ef&chksm=fbd749e1cca0c0f75c8a9dc06c16b8d9a53cdf57eb370c07424d88eefd1ddb66928dd1bf2f7f&scene=21#wechat_redirect">智能推荐算法在花椒直播中的应用</a></p>
<p> <strong>凤凰新闻</strong></p>
<p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247498125&idx=1&sn=52efbe5876151b48a917640f5f56c589&chksm=fbd74be1cca0c2f7b2f378a1b15339ef8697544c2b43bb9b51c7c9eaa79b6aea119d943786a9&scene=21#wechat_redirect">信息流推荐在凤凰新闻的业务实践</a></p>
<p> <strong>省钱快报</strong></p>
<p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247498064&idx=1&sn=66db655be0bcc5e6ee0dc58f869ef6eb&chksm=fbd74b3ccca0c22aacea4a7aca9e803f4044f78ad056983484ebc5ab0c718773ebd4ee8204ea&scene=21#wechat_redirect">深度学习在省钱快报推荐排序中的应用与实践</a></p>
<p> <strong>出门问问</strong></p>
<p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247496007&idx=1&sn=c0e0d603533c69a66d8ff93b54396ebd&chksm=fbd7432bcca0ca3de60cdde385c995f5e99dc79f34e254ae8eef579301017a727aa47ec5e20f&scene=21#wechat_redirect">用户行为序列推荐模型</a></p>
<p> <strong>知乎</strong></p>
<p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247487240&idx=1&sn=f38e4a5cd73a2d2f1d52ee5eda418528&chksm=fbd4bd64cca334720629ba997aca98642bc1e1b25c422623ddf07e30cb9a5f5068cf22af0048&scene=21#wechat_redirect">知乎推荐页Ranking经验分享</a></p>
<p> <strong>美图</strong></p>
<p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247498181&idx=1&sn=f3ee8fc793cc47d069913017f5aa7c74&chksm=fbd74ba9cca0c2bfef5fd5a07805b35cc90d15146899125e6bf21be2294a811e42d851cd2c06&scene=21#wechat_redirect">美图个性化推送的 AI 探索之路</a></p>
<p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247494558&idx=1&sn=10a6332147d713230d0fa4dbf9cdc897&chksm=fbd759f2cca0d0e4f5d39887a86b1d6efae13ad0540dc191fdbc8bb29120d0081a90c97b35f6&scene=21#wechat_redirect">深度学习技术在美图个性化推荐的应用实践</a></p>
<p> <strong>快看世界</strong></p>
<p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247493714&idx=1&sn=146ca2efa604b71b20ae166fb0cd6b85&chksm=fbd75a3ecca0d3280f88577c843d7ebf7c4b66f00134f2802e3863e17fa811eb8e328ca030a2&scene=21#wechat_redirect">快看漫画个性化推荐探索与实践</a></p>
<p> <strong>途家</strong></p>
<p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247491647&idx=1&sn=787f20dad8e613c0f72142df6789d91d&chksm=fbd75253cca0db45abed1a13b555f358ce059b4e9477afaeb872cab12d4fc310f119d65f797a&scene=21#wechat_redirect">Embedding 技术在民宿推荐中的应用</a></p>
<p> <strong>达观数据</strong></p>
<p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247498789&idx=2&sn=54346566c38a7142645137c8220bb51c&chksm=fbd74e49cca0c75f68e388e63e6671440fbc5b75e4213765f7644e2b8aead54c8a5464a7501a&scene=21#wechat_redirect">怎样评价推荐系统的结果质量？</a></p>
<p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247488752&idx=1&sn=aaaed48b319d572990c93dc1e60a7ba2&chksm=fbd4a69ccca32f8a636b600a77504ab7689f8e90279ace41ae669268dba533e5b8ece9e7b2d3&scene=21#wechat_redirect">达观数据个性化推荐系统实践</a></p>
<p> <strong>搜狗</strong></p>
<p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247485411&idx=1&sn=3ac29da8b7a81869bd33679531e2cfe3&chksm=fbd4b58fcca33c998652a1e1a84b4dee7b825df919e1c68702938ee24728121617ac30f85878&scene=21#wechat_redirect">搜狗信息流推荐算法交流</a></p>
<p> <strong>NVIDIA</strong></p>
<p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247513593&idx=2&sn=376de870c28403fa35087e438a4e6279&chksm=fbd70795cca08e838ee482038a321031db6f4725accb631d92587f111a856ea7217a7727b083&scene=21#wechat_redirect">Merlin：基于深度学习的推荐系统框架</a></p>
<p> <strong>脉脉</strong></p>
<p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247492644&idx=1&sn=79b3f706711de3195c8efc02b23cf0ac&chksm=fbd75648cca0df5ed5c04f529f5ec53c5debe285dc8baebcdcc67bddb975d3d296e6d8ce600a&scene=21#wechat_redirect">推荐技术随谈</a></p>
<p> <strong>360</strong></p>
<p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247487297&idx=1&sn=85cba65a01ec1e438216cb84565a0627&chksm=fbd4bd2dcca3343b0fd739b95e9a20c6d7e87f3ae3f725a09d4703b35ae4f644d4fb7c235afd&scene=21#wechat_redirect">机器学习与推荐系统实践</a></p>
<p> <strong>搜狐</strong></p>
<p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247485385&idx=1&sn=3f181a137981d5bf1f2f68ab19d313be&chksm=fbd4b5a5cca33cb337b73a0d5395a21991dd3bd391230d4f5e9af8e835ba772438d905e3d000&scene=21#wechat_redirect">图片主题模型在推荐系统的应用实践</a></p>
<p> <strong>OPPO</strong></p>
<p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247485069&idx=1&sn=0c122c7506321b1cd6069e4079ff744c&chksm=fbd4b4e1cca33df7169e31abb37295b1bcb4a2462690e636aaab8d65734de81bbaf147ac3e0f&scene=21#wechat_redirect">AI在OPPO个性化推荐中的应用</a></p>
<p><strong>来自大神的系统性总结</strong></p>
<p> <strong>姚凯飞</strong></p>
<p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247499687&idx=2&sn=e319f898f10f683e5e0a3ffd835d6a19&chksm=fbd74dcbcca0c4dd1b8a81cffe15cafed0ad3f831d746a00bbe0baf0f4bb137551b755e8f30c&scene=21#wechat_redirect">做推荐系统之余，我们该思考什么？</a></p>
<p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247493202&idx=1&sn=2c9de4b8f1d9c02cda8680496d7acab1&chksm=fbd7543ecca0dd281ad36f974fae6e3863817a6d9b24d574e069b5285de6b69d50e191c21f90&scene=21#wechat_redirect">电商推荐那点事</a></p>
<p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247492940&idx=1&sn=501df3fe540e7d5d2f69b6a8e8be8a6f&chksm=fbd75720cca0de365550dd8267be272d67b8f529363ba9359c40a86dbc97665b004937418ae2&scene=21#wechat_redirect">多维度分析：推荐效果明显的产品属性</a></p>
<p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247492304&idx=1&sn=eebf41490bbb1ea78c5b45024b8b5537&chksm=fbd750bccca0d9aa8404b57d809c4cae3502fda555bc55c78230ea67448fb8bae834950a3ac7&scene=21#wechat_redirect">推荐系统：石器与青铜时代</a></p>
<p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247491453&idx=1&sn=b42d2b3637c4c9cec0b9ff8ebd4a95e8&chksm=fbd4ad11cca32407ca43c4575fedf8359521305d8defd04c3c5445e9fc88929303e9590545ab&scene=21#wechat_redirect">推荐系统衡量：ABtest 框架</a></p>
<p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247491059&idx=1&sn=4e57c075f7a249d90cfe9a57602d62ef&chksm=fbd4af9fcca32689ebfa57fde6979a9a8a245f7db09f18be79f8fe98fb04926e1f594d0220d3&scene=21#wechat_redirect">推荐系统评价：什么是好的推荐系统</a></p>
<p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247489574&idx=2&sn=17a93acbbebe9de3b170611c8b6296bf&chksm=fbd4aa4acca3235c09ef69be50886d719caed4a0d9f1094dbbd3efd7149dcd563bc3bd8a1638&scene=21#wechat_redirect">个性化推荐技术</a></p>
<p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247492426&idx=1&sn=5a3cf9bba5d47aa9c2b2826191843a65&chksm=fbd75126cca0d8307ac4c4269a47adf8c0edd8bfb3000a952b9fe977f0f3ca315edcde716f4b&scene=21#wechat_redirect">推荐排序</a></p>
<p> <strong>张俊林</strong></p>
<p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247496363&idx=1&sn=0d2b2ac176e2a72eb2e760b7b591788f&chksm=fbd740c7cca0c9d16c76fdeb1a874a53f7408d8125b2e1bed3173ecb69d131167c1c9c35c71f&scene=21#wechat_redirect">推荐系统技术演进趋势：召回-&gt;排序-&gt;重排</a></p>
<p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247499753&idx=2&sn=da9c4b5876a70f447f8fa5cda834f4b5&chksm=fbd74d85cca0c493c2a1473e4e5966b9a2db997ee02e484eb464afc71030f8af3ec44ee1efb5&scene=21#wechat_redirect">推荐系统中稀疏特征 Embedding 的优化表示方法</a></p>
<p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247489042&idx=1&sn=883b9380fbd3fe5fab82e1984cff7e27&chksm=fbd4a47ecca32d68f4ea7397998184924b9b173c2eec4c82fd3bcd9c210425eb1f4867a12392&scene=21#wechat_redirect">推荐系统召回四模型之二：沉重的FFM模型</a></p>
<p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247500473&idx=1&sn=d80079358ca353fc917a2fb31431763b&chksm=fbd770d5cca0f9c378b1047b4fd6ecd0d46832de4ce070f5e24c3ea46f68ce809b6fdb6937ff&scene=21#wechat_redirect">知识蒸馏在推荐系统中的应用</a></p>
<p> <strong>梦想做个翟老师</strong></p>
<p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247496157&idx=1&sn=d7a00dad2fb9c206ab7ba75fc5c4358d&chksm=fbd743b1cca0caa79c4c0675b5dd9420b33fcb68a560890ad2168412bdf61ce0f1a80fe0ceea&scene=21#wechat_redirect">推荐场景中召回模型的演化过程</a></p>
<p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247496333&idx=1&sn=da03f8db68e5276cffe73e090ac271ec&chksm=fbd740e1cca0c9f76da90a713311bac81e9890c1f9fd69976705e167dd30e4135db6ea297d6b&scene=21#wechat_redirect">多任务学习在推荐算法中的应用</a></p>
<p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247499206&idx=1&sn=3ca9afb2f7b15d7a5f17be8e8e511b9b&chksm=fbd74faacca0c6bcd392db99ec2e4425aafc51157979205418aa2ed9636ba365deff9effadca&scene=21#wechat_redirect">Attention机制在深度学习推荐算法中的应用</a></p>
<p> <strong>辛俊波</strong></p>
<p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247496713&idx=1&sn=07bb184081bf8590db12e63ccda6bf22&chksm=fbd74665cca0cf73e625c403d61bb3f1f0fdfe680566927f1b1cda7cb54a7b9ce17418c9690b&scene=21#wechat_redirect">推荐系统中的深度匹配模型</a></p>
<p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247499284&idx=1&sn=ed11fb81ffb5a6de80b00a4daacbcc6b&chksm=fbd74c78cca0c56e320f2dd324424e1156e79ffefbd146fabf819e1b131dfa5edecd17ae77f1&scene=21#wechat_redirect">在你做推荐系统的过程中都遇到过什么坑？</a></p>
<p> <strong>哥不是小萝莉</strong></p>
<p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247508141&idx=2&sn=b93e1baadafec7ad6b28c4c43a9c266e&chksm=fbd712c1cca09bd77d33847222834b0b8be51c20acfb0251805971e156c287b9e44ab7bdd8e8&scene=21#wechat_redirect">基于用户的协同过滤来构建推荐系统</a></p>
<p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247507976&idx=2&sn=c71bc471e23b239a22a8dfe6d1159ed9&chksm=fbd71264cca09b722e10d3b22269171d558ffaf013dabe5b41d9e631e4f94ba31490180cfa1d&scene=21#wechat_redirect">如何构建一个生产环境的推荐系统</a></p>
<p> <strong>浅梦</strong></p>
<p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247498816&idx=1&sn=2f64ef4d479e721d3b255f70d51ed445&chksm=fbd74e2ccca0c73af7ed0a1a54844edc64a4778668201d8fb536b52f514e44e627ae79efc49d&scene=21#wechat_redirect">DeepMatch：用于广告和推荐的深度召回匹配算法库</a></p>
<p> <strong>邹敏</strong></p>
<p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247489798&idx=1&sn=c9b43455db52640c739be800362ca2fb&chksm=fbd4ab6acca3227c1677382917f3746cad6819a52c930e3867e118ba7af1d8836190d3e0980a&scene=21#wechat_redirect">分类模型与排序模型在推荐系统中的异同分析</a></p>
<p> <strong>张相於</strong></p>
<p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247485031&idx=1&sn=4da5a667e04b0a300fba6db13b079f94&chksm=fbd4b40bcca33d1d9a36395b82f0f15a5b9395f4ccb7da0c31ab72d63d63481f381f8c298ab5&scene=21#wechat_redirect">电商平台推荐系统架构演进</a></p>
<p> <strong>Others</strong></p>
<p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247499347&idx=1&sn=0fde3a3b3994b040477fcae4eff3b7fd&chksm=fbd74c3fcca0c529d61453ab410d48fe98786137944d9a1ccd098d0c30d40cf53cfabacf55e7&scene=21#wechat_redirect">图推荐算法在E&amp;E问题上的应用</a></p>
<p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247505416&idx=2&sn=81e65c69559952cef0ad5f6ac12e3ca9&chksm=fbd76464cca0ed721b9aef24d0f4b9da7ffdcd29341ddb5e1477c48ff08f68ccad76f69f7ed2&scene=21#wechat_redirect">基于内容和上下文的音乐推荐</a></p>
<p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247503167&idx=1&sn=4bcea1a5d9dcc75852d3ef19a042a39d&chksm=fbd77f53cca0f645b635c6e2bbe0f365fdc6628fe8827ced480ab35b42542bbc642d797d21d4&scene=21#wechat_redirect">社交推荐系统中的用户交互</a></p>
<p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247502080&idx=1&sn=f2e3484e8abd3a187976ff29ebc032d0&chksm=fbd77b6ccca0f27a11bf2d4f6a93fb95dae7b3bd40a26539299fd88a9f3c9db9da41a2dc0a45&scene=21#wechat_redirect">主流推荐引擎技术及优缺点分析</a></p>
<p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247498081&idx=1&sn=442ba26e13ac0df9a558df197daf2f79&chksm=fbd74b0dcca0c21b23b5ca6729d5ec82da435003902648e48e24568e0c1382f5c8ff944d0236&scene=21#wechat_redirect">知识图谱辅助的个性化推荐系统</a></p>
<p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247486975&idx=1&sn=8c5bacd451b8d08a3517dc691872f6cf&chksm=fbd4bf93cca336858770741723368e687958d3f19ff20aec614d72e2ab17fdfe68a973d278a5&scene=21#wechat_redirect">YouTube 基于深度神经网络推荐系统剖析</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/12/07/a/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Thousandth of Dirt">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/12/07/a/" itemprop="url">tvOS 关于Apple TV开发的注意事项</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-12-07T02:47:00+08:00">
                2020-12-07
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Swift/" itemprop="url" rel="index">
                    <span itemprop="name">Swift</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h1><p>有能力的小伙伴儿们可以去官方文档了解一下<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/General/Conceptual/AppleTV_PG/#//apple_ref/doc/uid/TP40015241-CH12-SW1">App Programming Guide for tvOS</a></p>
<p>接下来说几个tvOS的特别之处。</p>
<p><strong>1.Apple tvOS引入了一下几个特有的框架。</strong></p>
<ul>
<li>TVMLJS。描述了C/S应用中用来加载TVML页面的JavaScript接口。见<a target="_blank" rel="noopener" href="https://developer.apple.com/library/prerelease/tvos/documentation/TVMLJS/Reference/TVJSFrameworkReference/index.html#//apple_ref/doc/uid/TP40016076">《TVJS Framework Reference》</a>。</li>
<li>TVMLKit。提供一种整合JavaScript和TVML的方法。见<a target="_blank" rel="noopener" href="https://developer.apple.com/library/prerelease/tvos/documentation/TVMLKit/Reference/TVMLKit_Collection/index.html#//apple_ref/doc/uid/TP40016429">《TVMLKit Framework Reference》</a>。</li>
<li>TVServices。描述了如何为应用添加顶部扩展<a target="_blank" rel="noopener" href="https://developer.apple.com/library/prerelease/tvos/documentation/TVServices/Reference/TVServices_Ref/index.html#//apple_ref/doc/uid/TP40016412">《TVServices Framework Reference》</a>。</li>
</ul>
<p><strong>2.资源限制</strong></p>
<p>Apple TV上的应用没有持久化的本地存储。</p>
<blockquote>
<p>There’s an inconsistency regarding the Documents folder: you can create files in it when you run your app in the Simulator. But on the actual Apple TV, it just fails.</p>
</blockquote>
<p>虽然可以短暂存储在Caches或Temporary文件夹下，但是依然会被系统删除。</p>
<blockquote>
<p>You can write data to the Caches directory and the data should stay there as long as your app is running. But when your app exits, that data could be deleted by the system, so be prepared for it to be gone when your app launches again.</p>
</blockquote>
<p>这意味着每个应用都应该将数据存放在iCloud，并且通过一种用户体验较好的方式将它们获取到。</p>
<p>可以用NSUserDefaults存储一些参数，但是不可以存储很大的数据，最大也就512k。</p>
<blockquote>
<p>NSUserDefaultsSizeLimitExceededNotification is posted on the main queue when more data is stored in user defaults than is allowed. Currently there is no limit for local user defaults except on tvOS, where a warning notification will be posted at 512kB, and the process terminated at 1MB. For ubiquitous defaults, the limit depends on the logged in iCloud user.</p>
</blockquote>
<p>除了缺乏本地存储，Apple TV应用的大小也被限制在200MB。如果一个应用的大小超过了限制，就需要使用按需加载的方式将它们打包。知道什么时候加载以及如何价值新的资源对开发一款成功的应用非常重要。更多关于按需加载资源的信息，见<a target="_blank" rel="noopener" href="https://developer.apple.com/library/prerelease/tvos/documentation/FileManagement/Conceptual/On_Demand_Resources_Guide/index.html#//apple_ref/doc/uid/TP40015083">《On-Demand Resources Guide》</a>。</p>
<p><strong>3.焦点引擎</strong></p>
<p>我的个人理解是，tvOS不像iOS是电容屏的设备，可以用手指精准触碰到需要交互的视图上的操作，而是使用遥控器的方式进行焦点的移动，所以有了焦点的概念，例如UICollectionViewCell上的Button等。</p>
<p>只有焦点引擎能够显式的更新焦点，以为着系统并没有提供API来直接在某个方向操作和移动焦点，只有在用户发送移动事件、系统和应用请求更新的时候，焦点引擎才会更新焦点。更多关于焦点的更新，见<a target="_blank" rel="noopener" href="https://developer.apple.com/library/prerelease/tvos/documentation/General/Conceptual/AppleTV_PG/WorkingwiththeAppleTVRemote.html#//apple_ref/doc/uid/TP40015241-CH5-SW14">《Updating Focus Programmatically》</a>。</p>
<p>如果焦点引擎找到了一个可以接受焦点的视图，比如Cell或Button，它会通过shouldUpdateFocusInContext:代理方法给应用提供一个评估是否移动焦点的机会。焦点引擎按前一个和下一个的顺序通知每个焦点环境（先通知前一个视图，然后下一个视图，最后通知它们的父视图）。只要有一个视图返回NO，这次移动就会被取消。更多关于焦点环境的信息，见<a target="_blank" rel="noopener" href="https://developer.apple.com/library/prerelease/tvos/documentation/UIKit/Reference/UIFocusEnvironment_Protocol/index.html#//apple_ref/doc/uid/TP40015223">《UIFocusEnvironmentProtocol Reference》</a>。</p>
<p><strong>系统产生的焦点更新动作</strong></p>
<p>在许多环境下，必要的时候UIKit会自动更新焦点。下面是焦点自动更新的一些示例：</p>
<ul>
<li>焦点视图被移除。</li>
<li>UITableView或UICollectionView重新加载数据。</li>
<li>弹出一个新的视图控制器。</li>
<li>用户按<strong>Menu</strong>按钮返回。</li>
</ul>
<p><strong>在视图控制器中支持焦点</strong></p>
<p>因为UIViewController相应UIFocusEnvironment，自定义视图控制器可以覆盖UIFocusEnvironment中的代理方法来实现自定义焦点的行为。</p>
<p>自定义视图控制器:</p>
<ul>
<li>覆盖preferredFocusedView来明确焦点默认从哪里开始。</li>
<li>覆盖shouldUpdateFocusInContext:定义焦点如何移动。</li>
<li>覆盖didUpdateFocusInContext:withAnimationCoordinator:响应焦点的更新时机并且改变应用的状态。</li>
</ul>
<p>视图控制器可以通过调用setNeedsFocusUpdate请求焦点引擎来重置焦点到当前的preferredFocusedView上。注意，只有当该视图控制器包含一个已经获取焦点的视图时，setNeedsFocusUpdate才会起作用。</p>
<p><strong>在CollectionView和TableView中支持焦点</strong></p>
<p>使用UICollectionView和UITableView的时候，我们通过代理对象自定义焦点行为。这个模式同事也用于基于焦点的界面的实现。UITableViewDelegate和UICollectionViewDelegate协议定义了UIFocusEnvironment协议中相同的方法，但是只能给UITableView和UICollectionView使用。</p>
<p>在UICollectionView和UITableView中支持焦点的技巧：</p>
<ul>
<li>使用UICollectionViewDelegate中的collectionView:canFocusItemAtIndexPath:或者UITableViewDelegate中的tableView:canFocusRowAtIndexPath:方法表明一个Cell是否可以获取焦点。这与在自定义视图中重写canBecomeFocused方法的作用一样。</li>
<li>使用UICollectionView和UITableView中的remembersLastFocusedIndexPath属性表示离开焦点离开后，再次获取焦点时是否应该停留在最后一次的位置。</li>
</ul>
<p>这里可以参考我之前的一篇博客<a target="_blank" rel="noopener" href="https://blog.csdn.net/u012265444/article/details/80161668">tvOS UICollectionViewCell上添加UIButton改变焦点Focus</a>理解。</p>
<p><strong>在自定义视图中支持焦点</strong></p>
<p>UIViewController、UIView都实现了UIFocusEnvironment协议，因此所有在<a target="_blank" rel="noopener" href="https://developer.apple.com/library/prerelease/tvos/documentation/General/Conceptual/AppleTV_PG/WorkingwiththeAppleTVRemote.html#//apple_ref/doc/uid/TP40015241-CH5-SW1">在视图控制器中支持焦点</a>提到的都可以在自定义视图中使用。因为视图能够获取焦点，所以实现自定义视图的焦点行为时，还需要考虑一些额外的东西：</p>
<ul>
<li>如果自定义视图需要能够获取焦点，重写canBecomeFocused方法，并返回YES（默认返回NO）。视图可以是一直都能够获取焦点或者只能在一些条件下获取焦点。例如UIButton在禁用状态是不能获取焦点的。</li>
<li>如果一个视图需要将焦点重定向到领悟一个焦点（例如子视图），需要重写preferredFocusedView。</li>
<li>重写didUpdateFocusInContext:withAnimationCoordinator:响应焦点改变事件，并更新程序状态。</li>
</ul>
<p><strong>焦点相关动画</strong></p>
<p>当焦点发生改变的时候，获取焦点的视图执行动画，而前一个视图动画进入无焦点状态。与应用中的其它动画不一样的是，UIKit会调整焦点动画的时长和动画曲线来达到某种系统级的行为。例如，当焦点快速移动的时候，动画的时长会虽用户的移动而加速。</p>
<p>UIKit为支持焦点的视图类提供了系统定义的焦点动画。使用UIKit的内置类UIFocusAnimationCoordinator和addCoordinatedAniamtions:completion:方法可以为系统定义的行为创建动画。</p>
<p>添加到协调器的动画可以在获取焦点或者失去焦点的时候运行（不是同时），这取决于提供给协调器的焦点环境。获取焦点的视图和失去焦点的视图共同的父视图或者焦点获取视图的父视图，在焦点动画执行时，运行自己的动画。而失焦视图的父视图在失去焦点的时候执行动画。</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)didUpdateFocusInContext:(<span class="built_in">UIFocusUpdateContext</span> *)context withAnimationCoordinator:(<span class="built_in">UIFocusAnimationCoordinator</span> *)coordinator</span><br><span class="line">&#123;</span><br><span class="line">    [<span class="keyword">super</span> didUpdateFocusInContext:context withAnimationCoordinator:coordinator];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span> == context.nextFocusedView) &#123;</span><br><span class="line"></span><br><span class="line">        [coordinator addCoordinatedAnimations:^&#123;</span><br><span class="line">            <span class="comment">// focusing animations</span></span><br><span class="line">        &#125; completion:^&#123;</span><br><span class="line">            <span class="comment">// completion</span></span><br><span class="line">        &#125;];</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">self</span> == context.previouslyFocusedView) &#123;</span><br><span class="line">        [coordinator addCoordinatedAnimations:^&#123;</span><br><span class="line">            <span class="comment">// unfocusing animations</span></span><br><span class="line">        &#125; completion:^&#123;</span><br><span class="line">            <span class="comment">// completion</span></span><br><span class="line">        &#125;];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意：有许多原因会导致视图不能获取焦点，下面列举了一些例子（但不是全部）：</p>
<ul>
<li>视图的canBecomeFocused方法返回NO。</li>
<li>视图的hidden属性被设置为YES。</li>
<li>视图的alpha属性被设置为0。</li>
<li>视图被设置为不能接受用户交互。</li>
<li>视图被其它视图覆盖。</li>
</ul>
<p>UIKit为UIView提供了一个隐藏的方法_whyIsThisViewNotFocusable来帮助测试上面提到的几种情况。这个方法只在调试器中有用，并且会将可能的原因打印出来。</p>
<blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">(lldb) po [(UIView *)0x148db5234 _whyIsThisViewNotFocusable]</span><br><span class="line">ISSUE: This view has userInteractionEnabled set to NO. Views must allow user interaction to be focusable.</span><br><span class="line">ISSUE: This view returns NO from -canBecomeFocused.</span><br><span class="line">(lldb) po [(UIView *)0x14b644d70 _whyIsThisViewNotFocusable]</span><br><span class="line">ISSUE: One or more ancestors are not eligible for focus, preventing this view from being focusable. Details:</span><br><span class="line"></span><br><span class="line">    &lt;ExampleAncestorView 0x148db5810&gt;:</span><br><span class="line">        ISSUE: This view has userInteractionEnabled set to NO. Views must allow user interaction to be focusable.</span><br></pre></td></tr></table></figure>
</blockquote>
<p>在UINaviGationController栈中的vc顶部的控件无法获得焦点，可能是UINavigationBar挡住了控件。</p>
<p>4.界面</p>
<p> <a target="_blank" rel="noopener" href="https://developer.apple.com/tvos/human-interface-guidelines/">tvOS Human Interface Guidelines</a></p>
<p>触摸板事件：滑动，点击，轻触。</p>
<p>Apple TV上的所有图片按@1x分辨率提供。</p>
<p>每个应用必须提供一个小尺寸和大尺寸图标。应用图标必须呈递两种尺寸，两者长宽比相同。</p>
<p>小尺寸图标——这个尺寸的图标在Apple TV主屏上使用。</p>
<p>实际尺寸：400px by 240px</p>
<p>安全区域尺寸：370px by 222px</p>
<p>非聚焦态尺寸：300px by 180px</p>
<p>聚焦态尺寸：370px by 222px</p>
<p>大尺寸图标——这个尺寸的图标在App Store使用。</p>
<p>尺寸：1280px by 768px</p>
<p>大尺寸图标应照搬小尺寸图标的设计。尽管大尺寸图标与小图标使用不同，它仍然是你的应用图标，应该在外观与小图标相匹配。</p>
<p>应用图标安全区域模板能够帮你把内容放在合适位置</p>
<p>顶部展区(<strong>Top Shelf</strong>)图片</p>
<p>最低要求：每个应用至少提供单张顶部展区静态图——当应用在主屏最上面一行且被选中聚焦时使用。</p>
<p><strong>顶部展区静态图</strong> 尺寸：1920px by 720px</p>
<p><strong>启动图像</strong> 尺寸：1920px by 1080px </p>
<p><strong>标签栏 Tab Bars</strong> 高度：140px</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/12/07/AppleTV%E7%BC%96%E7%A8%8B%E6%8C%87%E5%8D%97%E4%BA%8C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Thousandth of Dirt">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/12/07/AppleTV%E7%BC%96%E7%A8%8B%E6%8C%87%E5%8D%97%E4%BA%8C/" itemprop="url">Apple TV 编程指南：使用Apple TV遥控器控制屏幕上的用户界面</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-12-07T02:16:00+08:00">
                2020-12-07
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>原文：App Programming Guide for tvOS：Building Apple TV Apps–Controlling the User Interface with the Apple TV Remote</p>
<p>本文档文章包括</p>
<ul>
<li>Apple TV 编程指南：介绍</li>
<li>Apple TV 编程指南：创建Client-Server App</li>
<li>Apple TV 编程指南：使用Apple TV遥控器控制屏幕上的用户界面</li>
<li>Apple TV 编程指南：检测手势和按钮按压</li>
<li>Apple TV 编程指南：设计键盘输入体验</li>
<li>Apple TV 编程指南：使用游戏控制器</li>
<li>Apple TV 编程指南：创造视差美术资源</li>
<li>Apple TV 编程指南：资源管理</li>
</ul>
<h6 id="使用Apple-TV遥控器控制屏幕上的用户界面"><a href="#使用Apple-TV遥控器控制屏幕上的用户界面" class="headerlink" title="使用Apple TV遥控器控制屏幕上的用户界面"></a>使用Apple TV遥控器控制屏幕上的用户界面</h6><p>在iOS设备上，用户通过触屏直接进行交互。在苹果电视上，用户使用遥控器进行间接交互。用户浏览到一个特定的选项上，然后按下遥控器上一个按钮来选择这个选项。当用户选中屏幕上的选项时，该选项就会变成焦点。焦点是指用户间接地通过远程的或者其他的输入设备进行的输入行为引起的屏幕的外部效果。在一个以焦点为基础的交互模型中，在屏幕上的单一视图可以得到焦点，并且用户可以通过浏览屏幕上不同的UI选项将焦点移动到其他视图，从而引起焦点更新。得到焦点的视图被用作任何用户操作的目标事件。例如，如果一个屏幕上的按钮被选中，当由遥控器发送按钮选择事件时，目标事件将被触发。</p>
<p>UIKit框架只支持以焦点为基础的交互，在大多数情况下，这种行为只在有意义的地方自动提供。你可以要求以编程形式焦点更新，但不能将焦点往某个方向设置或者移动。例如，UIButton对象有焦点，但UILabel对象都没有。对于自定义用户界面组件的应用程序，你需要实现自定义的焦点目标事件，正如Supporting Focus Within Your App中解释一样。UIKit库中，如UIButton，UITextField，UITableView，UICollectionView，UITextView，UIsearchbar 以及UISegmentedControl有默认焦点。</p>
<h6 id="焦点引擎控制焦点"><a href="#焦点引擎控制焦点" class="headerlink" title="焦点引擎控制焦点"></a>焦点引擎控制焦点</h6><p>包含可控制焦点的UIKit的系统和焦点移动称为焦点引擎。有许多用户可以控制焦点的输入设备，例如（不同类型）遥控器，游戏控制器，模拟器等等。在你的应用程序中，焦点引擎监听来自这些不同输入设备的焦点移动事件。当一个事件发生时，焦点引擎会自动判断更新焦点并通知你的应用程序。该系统有助于创造一个持续性的用户体验，即提供了每一个应用程序中所有当前和未来的输入方法的自动支持，并帮助开发人员专注于实现他们的应用程序的独特行为而不是定义或重塑基本的导航。</p>
<p>只有焦点引擎才能显式更新焦点，这意味着没有一个可直接设置焦点的视图或移动焦点往一个特定方向的接口。如果用户发送一个移动事件，如果焦点引擎系统要求更新，或者如果应用程序请求更新，该焦点引擎只更新焦点。要了解更多关于如何手动更新的焦点，请参看 Updating Focus Programmatically 一节。</p>
<p>焦点引擎控制主要是确保焦点不在屏幕上意外地移动，并且它的行为在不同的应用程序中是相似的。这有助于防止用户对不同的行为感到困惑，同时意味着开发人员不必自己定制适当的焦点管理解决方案。</p>
<h6 id="UIFocusEnvironment协议"><a href="#UIFocusEnvironment协议" class="headerlink" title="UIFocusEnvironment协议"></a>UIFocusEnvironment协议</h6><p>焦点引擎通过UIFocusEnvironment协议，与你的应用程序进行通信。 UIFocusEnvironment 协议定义了视图层次结构的一个分支的焦点行为。UIKit库中遵循这个协议的类有UIView、UIViewController、UIWindow 和 UIPresentationController，换句话说，这些类都直接或间接地控制在屏幕上的视图。在视图和视图控制器中重写UIFocusEnvironment协议方法，你可以在应用程序中控制焦点行为。</p>
<h6 id="用户生成的焦点移动"><a href="#用户生成的焦点移动" class="headerlink" title="用户生成的焦点移动"></a>用户生成的焦点移动</h6><p>焦点引擎可以根据遥控器或者其他输入设备的响应事件自动决定焦点应该移动到哪里。用户可以将焦点转移到任何二维方向：上下左右或对角线（如果硬件支持的话）。例如，如果用户左滑，焦点引擎试图直接找到在当前获得焦点的视图左边的一个视图，这个视图必须具有可以获得焦点的特性。如果一个新的视图被发现，则焦点移动到该视图；否则，焦点停留在当前激活的视图。</p>
<p>如果输入设备支持，焦点引擎也自动处理复杂的行为。例如，基于运动的远程滑动，根据焦点速度调节焦点相关的动画速度，播放导航的声音，和当焦点移出屏幕，时更新滚动视图偏移。要了解更多关于焦点相关的动画，请参看 UIFocusAnimationCoordinator类参考。</p>
<h6 id="决定在哪里移动焦点"><a href="#决定在哪里移动焦点" class="headerlink" title="决定在哪里移动焦点"></a>决定在哪里移动焦点</h6><p>当决定如何按照用户动作移动焦点时，焦点引擎需要应用程序内部的用户界面和所有的具有可获得焦点特性的所有视图的可视区域。这意味着，如果一个可获得焦点的视图在完全在另一个可获得焦点视图的下面，那么它将会被忽略，不能得到焦点。也就是说部分区域隐藏的视图，只有可见部分才能获得焦点。利用这一技术，焦点引擎从当前获得焦点的视图开始，在运动路径上直接找到可以获得焦点的区域。搜索区域的大小与当前焦点视图的大小直接相关。</p>
<p>图 3-1焦点移动</p>
<p><img src="/images/pasted-5.png" alt="upload successful"></p>
<p>如果焦点引擎找到一个新的视图去移动焦点，那么它会在移动焦点发生之前给你的应用程序一个验证移动的机会。操作系统在每个包含上一个和下一个焦点视图的焦点环境上都会调用 shouldUpdateFocusInContext:方法。先通知先前的焦点视图，然后是焦点视图，最后通知父视图。如果所有焦点环境 shouldupdatefocusincontext：的返回值为NO，那么这个焦点移动将会被取消。要了解更多关于焦点环境的知识，参见 UIFocusEnvironment Protocol Reference.</p>
<h6 id="初始焦点和首选焦点链"><a href="#初始焦点和首选焦点链" class="headerlink" title="初始焦点和首选焦点链"></a>初始焦点和首选焦点链</h6><p>当一个应用程序启动时，焦点引擎决定一个默认的焦点视图获得焦点。这个视图通常是距屏幕左上角最近的一个可获得焦点的视图。</p>
<p>图 3-2分层搜索的初始视图，以获得焦点。</p>
<p><img src="/images/pasted-6.png" alt="upload successful"></p>
<p>但是，使用 UIFocusEnvironment 协议的首选焦点视图，可以为你的应用程序提供默认情况下焦点该去哪的线索。当设置初始化焦点时，焦点引擎首先询问 window 的首选的焦点视图，这个视图就是根视图控制器的 preferredFocusedView 对象。因为返回值是一个符合 UIFocusEnvironment 协议的 UIView 对象，所以焦点引擎询问其首选的焦点视图，以次类推。这个由一系列作为返回值的首选焦点视图组成的链表是首选焦点链。焦点引擎遵循这个首选焦点链，直到得到的焦点视图是它本身或者是nil。从首选焦点链中的最后一个列表中选择位置最深处的视图作为下一个可获得焦点的视图。</p>
<h6 id="下面这个例子展示什么是首选焦点链："><a href="#下面这个例子展示什么是首选焦点链：" class="headerlink" title="下面这个例子展示什么是首选焦点链："></a>下面这个例子展示什么是首选焦点链：</h6><p>焦点引擎向根窗口查询 preferredFocusedView，并返回它的根视图控制器下的 preferredFocusedView。</p>
<p>根视图控制器是选项卡视图器的时候，返回值是它的被选者的视图控制器的 preferredFocusedView 对象。</p>
<p>被选择视图控制器重写其 preferredFocusedView 方法，返回一个特定的 UIButton实例对象。</p>
<p>这个 UIButton 实例对象返回 self（默认值），并可获得焦点，所以它被焦点引擎选择作为下一个焦点视图。</p>
<p>正如首选焦点链所定义的那样，每当焦点在一个指定的视图更新时，新的焦点视图都会被设定为首选焦点视图。焦点链的另一个例子，当有一个视图控制器呈现在当前焦点视图的上面时，焦点引擎会使用它的首选焦点链更新焦点到新的视图控制器上。<br>焦点更新</p>
<p>当用户行为引起了焦点运动时就会引起焦点更新（例如，在遥控器上滑动），这时应用将会请求更新焦点或者系统自定触发更新焦点。</p>
<h6 id="焦点更新的解析"><a href="#焦点更新的解析" class="headerlink" title="焦点更新的解析"></a>焦点更新的解析</h6><p>当焦点更新或者焦点移动到一个新的视图的时候，无论焦点视图是子视图或者不同于这个视图层级的部分，都将会有下列事情发生：</p>
<p>focusedView 属性被更新，并且更新的效果会反应到最新的到焦点的视图或者首选焦点视图上。</p>
<p>焦点引擎使用didUpdateFocusInContext:withAnimationCoordinator:方法通知每一个焦点环境，包含先前焦点视图或下一个焦点视图（焦点更新后的视图）的焦点环境。焦点更新时，系统会使用动画协调员安排焦点更新相关的动画。详见 UIFocusAnimationCoordinator。</p>
<p>在所有相关的焦点环境得到通知后，所有的协调动画都在同一时间运行。</p>
<p>如果下一个焦点视图是在一个滚动视图上，并且在屏幕以外，那么滚动视图将会滚动到该视图所在的位置，使它移进屏幕内。</p>
<h6 id="系统生成的焦点更新"><a href="#系统生成的焦点更新" class="headerlink" title="系统生成的焦点更新"></a>系统生成的焦点更新</h6><p>在许多常见的情况下，必要的时候UIKit会自动更新焦点。下面的几个例子展示了什么情况下系统会自动的更新焦点：</p>
<ol>
<li>从视图层次结构中移除一个焦点视图。</li>
<li>UITableView 或 UICollectionView 重新加载数据。</li>
<li>在当前获得焦点的视图上展示一个新的视图控制器。</li>
<li>用户按下遥控器上的菜单回退。</li>
</ol>
<h6 id="以编程方式更新焦点"><a href="#以编程方式更新焦点" class="headerlink" title="以编程方式更新焦点"></a>以编程方式更新焦点</h6><p>通常情况下，焦点会在必要的时候自动更新，但是有时候，你需要在应用程序内部，用代码主动引起焦点更新。任何焦点环境通过调用 setNeedsFocusUpdate方法请求焦点更新，这个方法重置了焦点环境的 preferredFocusedView。下面是一些何时可以在你的应用内部主动的更新焦点的例子：</p>
<p>如果应用程序的内容发生变化，那么为了留在用户所期望的地方，则需要改变焦点。例如:音乐类应用程序总是希望专注当前播放的歌曲。当一首歌曲结束时，应用程序应该请求更新的焦点，并移动到播放列表中得下一首歌曲。</p>
<p>用户期望焦点转移到某个新的地方的操作行为。例如：一个应用程序的界面由两个部分组成，左边是一个菜单，右边是对应菜单项的内容集合。当用户在菜单项之间移动时，右边的内容更改。当用户选中一个菜单项时，他们可能会期待焦点自动移动到选定的菜单项集合中的第一项。</p>
<p>得到焦点的自定义的焦点控件，更新它的内部状态时需要以某种方式改变焦点。例如: 当用户在遥控器上选定选取器件时，焦点会移动到这个控件上，让用户选取选取器上的一系列选项。按下遥控器上的菜单又会导致改控件获得焦点。在这种场景下，通过 preferredFocusedView，选择控件会发出请求更新焦点移动到它的一个子视图上。</p>
<h6 id="让你的APP支持焦点"><a href="#让你的APP支持焦点" class="headerlink" title="让你的APP支持焦点"></a>让你的APP支持焦点</h6><p>如果你的应用程序使用内置 UIKit 控件，你的应用程序什么都不用做就可以支持焦点：在应用程序启动时，屏幕上的一个可获得焦点的视图会被选择作为最初的焦点视图，在应用程序的运行周期中，焦点引擎负责管理焦点。</p>
<p>然而，对于大多数应用程序来说，都希望实现某些自定义的焦点行为，例如，当焦点改变时，更新应用程序状态，创建新的用户交互界面元素类型，并实现自定义的焦点动画。下面的章节概述了在你的应用程序中实现支持自定义焦点行为需要做什么。</p>
<p>对一个视图层级结构的分支来说 UIFocusEnvironment 类控制焦点相关行为。这意味着控制器控制着它的根视图和子节点视图的焦点相关行为，并且 UIView 类型对象控制它自己和它子节点的焦点行为。因此，多个焦点环境，可以控制同一个视图层级结构的分支的焦点相关行为。视图层级结构分支是指视图不但包含其他视图，而且还在视图控制器中。控制焦点相关行为并不是意味着某个视图获得焦点，而是意味着焦点环境可以控制焦点在它的视图层级上如何移动，在焦点环境下的视图层级上焦点改变后，UI如何应对。</p>
<h6 id="在视图控制器中支持焦点"><a href="#在视图控制器中支持焦点" class="headerlink" title="在视图控制器中支持焦点"></a>在视图控制器中支持焦点</h6><p>因为 UIViewController 遵循 UIFocusEnvironment 协议，所以在你的应用程序中，自定义视图控制器可以重写 UIFocusEnvironment 委托方法来实现自定义的焦点行为。自定义视图控制器可以实现如下功能：</p>
<ol>
<li>重写 preferredFocusedView 方法指明焦点默认开始的视图。</li>
<li>重写 shouldUpdateFocusInContext:方法来定义焦点允许移动的位置。</li>
<li>在更新你的应用程序的内部状态或者焦点更新发生时，重写 didUpdateFocusInContext:withAnimationCoordinator: 方法来对焦点更新。</li>
<li>通过调用 setNeedsFocusUpdate方法，你的视图控制器可以请求焦点引擎为当前的 preferredFocusedView 重置焦点。注意，只有视图控制器包含当前焦点视图，调用setneedsfocusupdate 才有效果。</li>
</ol>
<h6 id="在Collection视图和Table视图中支持焦点"><a href="#在Collection视图和Table视图中支持焦点" class="headerlink" title="在Collection视图和Table视图中支持焦点"></a>在Collection视图和Table视图中支持焦点</h6><p>当使用 collection 视图和 table 视图工作时，你可以使用委托对象来定义任何自定义行为。这种模式也可以基于焦点交互界面实现时使用。UITableViewDelegate 和UICollectionViewDelegate 协议声明的方法和属性和 UIFocusEnvironment 协议提供的属性和方法相似，但是 tableView 和 collectionView 的协议是规范他们自己的行为的。</p>
<h6 id="在collection视图和table视图中支持焦点的提示："><a href="#在collection视图和table视图中支持焦点的提示：" class="headerlink" title="在collection视图和table视图中支持焦点的提示："></a>在collection视图和table视图中支持焦点的提示：</h6><p>使用 UICollectionViewDelegate 的 collectionView:canFocusItemAtIndexPath: 方法或者 UITableViewDelegate 的 tableView:canFocusRowAtIndexPath: 方法去检查某个特殊的 cell 是否需要焦点。这一行动的工作类似于在一个自定义视图中重写 UIView 的 canBecomeFocused 方法。</p>
<p>当焦点离开当前视图时，使用在 UICollectionView 和 UITableView 中都有定义的 remembersLastFocusedIndexPath 属性，检查焦点是否应该返回上一个焦点索引， 指定焦点是否应返回焦点离开时的最后一个焦点索引路径，然后焦点重新进入 collectionView 或者 tableView 视图。</p>
<h6 id="在自定义视图中支持焦点"><a href="#在自定义视图中支持焦点" class="headerlink" title="在自定义视图中支持焦点"></a>在自定义视图中支持焦点</h6><p>像 UIViewController 和 UIView 类也遵循 UIFocusEnvironment 协议，这意味着 Supporting Focus in View Controllers 文档中概述的所有的功能都可以应用到自定义的视图中。但是，因为视图可以获得焦点，所以在你实现自定义的焦点行为的时候，需要考虑下面的几个因素：</p>
<p>如果你的自定义视图需要焦点，重写 canBecomeFocused方法并设置返回值为 YES（默认情况下，它的返回值为NO）。你的视图可能经常得到焦点或在某种情况下才能得到焦点。例如，UIButton 对象的 enable 属性为 NO 的时候，它不能得到焦点。</p>
<p>如果聚焦这一观点必须重新聚焦到另一个视图（例如，一个子视图），选择重写 preferredFocusedView。</p>
<p>更新你的应用程序的内部状态或者焦点更新发生时，重写 didUpdateFocusInContext:withAnimationCoordinator: 方法作为焦点更新后的反应行为。</p>
<h6 id="协调焦点相关动画"><a href="#协调焦点相关动画" class="headerlink" title="协调焦点相关动画"></a>协调焦点相关动画</h6><p>当焦点发生更新时，当前视图以某种动画的形式过度到焦点状态，之前的焦点视图以某种动画形式过度到非焦点状态，焦点更新后获得焦点的视图将以某种动画形式过度到焦点状态。然而，这些动画和你应用程序中定义的常见的动画不同，为了实现某种系统级别的行为，UIKit 使与焦点相关的动画的曲线轨迹和运动时间相适应。例如，当焦点正在快速移动时，动画的时间会缩短，以跟上用户的移动。</p>
<p>UIKit提供系统定义的有关可以获得焦点的视图类的焦点动画。使用 UIKit 的内置 UIFocusAnimationCoordinator 类和 addCoordinatedAnimations:completion: 方法，可以创建带有系统级行为的自定义动画。</p>
<p>根据协调器提供了的焦点环境，被添加到协调器中的动画可以作为正在获取焦点的动画中的边缘动画，或者失去焦点中得动画，或者两者都不是。一般情况下，获得焦点和失去焦点的父视图，和特殊的焦点视图的父视图一样，将会沿着获得焦点的方向做动画。非焦点视图独有的父视图将会做失去焦点的动画。</p>
<p>图 3-3自定义焦点动画</p>
<p><img src="/images/pasted-7.png" alt="upload successful"></p>
<p>通常，视图拥有不同的动画，取决于他们正在得到焦点或失去焦点。通过重写视图的 didUpdateFocusInContext:withAnimationCoordinator: 方法和检查视图的当前焦点的状态的上下文，你可以指定视图需要哪种动画。下面是重写 didUpdateFocusInContext:withAnimationCoordinator: 方法的例子。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">- (void)didUpdateFocusInContext:(UIFocusUpdateContext *)context withAnimationCoordinator:(UIFocusAnimationCoordinator *)coordinator</span><br><span class="line">&#123;</span><br><span class="line">    [super didUpdateFocusInContext:context withAnimationCoordinator:coordinator];</span><br><span class="line"> </span><br><span class="line">    if (self &#x3D;&#x3D; context.nextFocusedView) &#123;</span><br><span class="line">        [coordinator addCoordinatedAnimations:^&#123;</span><br><span class="line">            &#x2F;&#x2F; focusing animations</span><br><span class="line">        &#125; completion:^&#123;</span><br><span class="line">            &#x2F;&#x2F; completion</span><br><span class="line">        &#125;];</span><br><span class="line">    &#125; else if (self &#x3D;&#x3D; context.previouslyFocusedView) &#123;</span><br><span class="line">        [coordinator addCoordinatedAnimations:^&#123;</span><br><span class="line">            &#x2F;&#x2F; unfocusing animations</span><br><span class="line">        &#125; completion:^&#123;</span><br><span class="line">            &#x2F;&#x2F; completion</span><br><span class="line">        &#125;];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>非焦点和焦点视图共同的父视图，可以为焦点视图和非焦点视图一起关联相关动画。例如，一个 UICollectionView 对象可以将之前获得焦点的cell以及将要获得焦点的 cell 一起做动画。在对 UICollectionViewCell 的子类情况下，推荐使用上面代码片段的相似逻辑，并在子类中实现动画代码。</p>
<h6 id="调试焦点问题"><a href="#调试焦点问题" class="headerlink" title="调试焦点问题"></a>调试焦点问题</h6><p>当应用程序运行时，UIKit帮助你调试的焦点问题。</p>
<p>为什么这个视图不能获得焦点？</p>
<p>一个被期望获得焦点的视图却不能获得焦点的原因有很多种，下面列举了几种可能的原因但并不是全部原因：</p>
<p>视图的 canBecomeFocused 方法返会值为 NO 。</p>
<p>视图的 hidden 属性值设置为 YES 。</p>
<p>视图的透明度属性值为 0 。</p>
<p>视图的用户交互被禁用。</p>
<p>这个视图被它上面的视图完全遮盖。</p>
<p>UIKit 提供的 UIView 类的隐藏方法——_whyIsThisViewNotFocusable，目的是为了帮助测试所有前面提到的常见情况。此方法仅是在调试一个特别的视图引用时调用，并打印出一个具有可读性并且可能引起问题的如下所示的列表：</p>
<p>32.png</p>
<h6 id="为什么焦点移动到你没有想到的某个地方？"><a href="#为什么焦点移动到你没有想到的某个地方？" class="headerlink" title="为什么焦点移动到你没有想到的某个地方？"></a>为什么焦点移动到你没有想到的某个地方？</h6><p>有时候，焦点并没有移动到你所期待的地方，或者它根本就没有移动。焦点引擎提供了很多便利，有时候你最好了解关于它是如何移动焦点的更多信息。  </p>
<p>UIKit发送了一个可视化的关于焦点引擎在 Quick Look 中如何搜寻下一个焦点视图的 UIFocusUpdateContext 实例对象。为了看到这个场景，可以在shouldUpdateFocusInContext: 或者 didUpdateFocusInContext:withAnimationCoordinator: 方法中设置断点，当程序运行到这个断点时，在调试台中选中 context 参数并代开 Quick Look 菜单选项。</p>
<p>图 3-4在调试器中选择上下文参数</p>
<p><img src="/images/pasted-8.png" alt="upload successful"></p>
<p>如果断点在焦点运动的过程中被执行（不是焦点更新时）， Quick Look会展示一张图片来表达搜索引擎找到下一个焦点视图的搜索路径。例子如下3-5图。</p>
<p>图 3-5快速寻找一个图像显示</p>
<p><img src="/images/pasted-9.png" alt="upload successful"></p>
<p>下面是 Quick Look 中图片可能展示的几种信息</p>
<ol>
<li>以前的焦点视图（搜索的开始视图），显示在红色区域。</li>
<li>搜索路径轮廓，用虚线标注。</li>
<li>任何在搜索路径中可获得焦点的 UIView 对象区域，显示紫色。</li>
<li>任何在搜索路径中可获得焦点的 UIFocusGuide 类区域，显示蓝色。</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/12/07/AppleTV%E7%BC%96%E7%A8%8B%E6%8C%87%E5%8D%97%E4%B8%80/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Thousandth of Dirt">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/12/07/AppleTV%E7%BC%96%E7%A8%8B%E6%8C%87%E5%8D%97%E4%B8%80/" itemprop="url">AppleTV编程指南一</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-12-07T01:58:00+08:00">
                2020-12-07
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Swift/" itemprop="url" rel="index">
                    <span itemprop="name">Swift</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>原文：App Programming Guide for tvOS–The New Apple TV</p>
<p><img src="/images/pasted-3.png" alt="upload successful"></p>
<h6 id="本文档文章包括"><a href="#本文档文章包括" class="headerlink" title="本文档文章包括"></a>本文档文章包括</h6><ul>
<li>Apple TV 编程指南：介绍</li>
<li>Apple TV 编程指南：创建Client-Server App</li>
<li>Apple TV 编程指南：使用Apple TV遥控器控制屏幕上的用户界面</li>
<li>Apple TV 编程指南：检测手势和按钮按压</li>
<li>Apple TV 编程指南：设计键盘输入体验</li>
<li>Apple TV 编程指南：使用游戏控制器</li>
<li>Apple TV 编程指南：创造视差美术资源</li>
<li>Apple TV 编程指南：资源管理</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">重要：这是针对于正在开发中的API或技术的预备文档(预发布版本)。苹果提供这份文档的目的是帮助你按照文中描述的方式对技术的选择及界面的设计开发进行规划。这些信息有可能发生变化，因此根据本文档的软件开发应当基于最终版本的操作系统和文档进行测试。该文档的新版本或许会随着API或相关技术未来的发展而进行更新。</span><br></pre></td></tr></table></figure>

<p>新的 Apple TV 不仅仅是一个被动的媒体播放器。Apple TV 的用户还可以玩游戏，使用工具类应用程序，看电影，享受并分享经验。这些功能的增加也给开发商提供了更多机会。</p>
<p>tv OS 开发由 iOS 开发衍生而来但又有所不同，包括 tv OS 特有的一些框架。你会发现 Apple TV 的开发跟 iOS 开发很相似，它结合了支持分享技术、多用户体验，并且开辟了你在 iOS 设备上没有发现的app开发领域的空间。你可以创建新的APP也可以使用 iOS 代码作为起点。无论是哪种开发，你使用的都是熟悉的工具（Xcode）、语言（Objective-C,Swift以及JavaScript）。本文档介绍了 Apple TV 的独特功能，并提供了帮你开始 tv OS app 开发之旅的深入指导信息。</p>
<p>当移植现有的项目时，你可以在 Xcode 工程中增加一个 target 以简化资源共享，但是你需要为 tv OS 创建新的 storyboards。你可能会需要了解用户如何浏览你的APP，然后让APP用户界面适用于 Apple TV。想要了解更多信息，请查看Apple TV Human Interface Guidelines（<a target="_blank" rel="noopener" href="http://www.cocoachina.com/design/20150924/13533.html">中文版</a>/<a target="_blank" rel="noopener" href="https://developer.apple.com/tvos/human-interface-guidelines/">英文版</a>）</p>
<p>创建Apple TV的配置文件与iOS创建的配置文件方法是一样的，即在Xcode中使用Fix Issue命令或者通过开发者中心网站来创建配置文件。更多关于 Apple TV 功能支持信息，请参看 <a target="_blank" rel="noopener" href="https://developer.apple.com/library/prerelease/tvos/documentation/IDEs/Conceptual/AppDistributionGuide/SupportedCapabilities/SupportedCapabilities.html#//apple_ref/doc/uid/TP40012582-CH38">Supported Capabilities</a>.</p>
<p>虽然 iOS 和 tv OS APP 是不同的实体（也就是说没有一个可以在两个平台上运行的二进制文件），但你可以创建一个绑定这些应用程序的通用购买。用户一次购买应用程序，但可以同时获得应用的 iOS 和 tv OS 版本。更多信息，请查看<a target="_blank" rel="noopener" href="https://developer.apple.com/library/prerelease/tvos/documentation/IDEs/Conceptual/AppDistributionGuide/Introduction/Introduction.html#//apple_ref/doc/uid/TP40012582">App Distribution Guide</a>。</p>
<h6 id="AppleTV硬件"><a href="#AppleTV硬件" class="headerlink" title="AppleTV硬件"></a>AppleTV硬件</h6><p>新的AppleTV有以下硬件规格：</p>
<ul>
<li>64-bit A8 处理器 </li>
<li>32 GB/64 GB 存储空间 </li>
<li>2 GB RAM</li>
<li>10/100 Mbps Ethernet</li>
<li>WiFi 802.11a/b/g/n/ac</li>
<li>1080p 分辨率</li>
<li>HDMI</li>
<li>全新Siri 遥控器/Apple TV 遥控器</li>
</ul>
<p>新Apple TV遥控器有两种控制方式：一种使用Siri，另一种是在屏幕上搜索。Siri搜索适用于以下国家：</p>
<p>澳大利亚\加拿大\法国\德国\日本\西班牙\英国\美国</p>
<p>图1-1展示的是新遥控器，它有以下按钮：</p>
<p><img src="/images/pasted-4.png" alt="upload successful"></p>
<ol>
<li>触摸界面。滑动浏览。按下选择。长按展示详情菜单。</li>
<li>菜单。按下返回上个菜单。</li>
<li>Siri/搜索。长按与之进行对话（编辑注：适用于上边列出的国家）。在其他国家，按下该按钮则打开屏幕搜索应用程序。</li>
<li>播放/暂停。播放和暂停媒体。</li>
<li>Home按钮。按下返回主屏幕。按两次查看打开应用程序。长按休眠。</li>
<li>音量。控制TV音量。</li>
<li>Lightning接口。插入充电。<br>下图是Siri遥控器和Apple TV遥控器。</li>
</ol>
<h6 id="传统的APP"><a href="#传统的APP" class="headerlink" title="传统的APP"></a>传统的APP</h6><p>为 Apple TV 开发应用程序类似于 iOS APP 开发。你可以用 iOS 开发中相同的技术和框架来开发游戏、实用应用程序、媒体应用程序以及其他类型的应用。全新的以及现有的APP可以同时部署到 iOS 和新 Apple TV 平台。</p>
<h6 id="Client-Server-Apps（简写为-C-S-APP）"><a href="#Client-Server-Apps（简写为-C-S-APP）" class="headerlink" title="Client-Server Apps（简写为 C-S APP）"></a>Client-Server Apps（简写为 C-S APP）</h6><p>为Apple TV创建Client-Server APP（简写为 C-S APP）非常简单，它的主要目的是使用HTTPS、XMLHTTPRequest、DOM 以及 JavaScript 技术传输流媒体。你可以使用苹果的自定义标记语言–TVML 创建接口，并使用JavaScript指定 APP 的行为。TVMLKit框架在原生代码和 JavaScript 代码之间搭建了桥梁。</p>
<p>你可以在 JavaScript 文件中指定APP的初次启动行为。向往常一样创建你的二进制APP，再使用TVMLKit框架来加载 JavaScript 文件。JavaScript 文件加载 TVML页面并在屏幕上展示。你可以使用苹果提供的模板创建TVML页面。每个模板都提供了独一无二的全屏信息展示。你可以通过添加或者移除模板中的元素来调整页面。关于苹果提供的TVML模板和元素列表，请查看 Apple TV Markup Language Reference。</p>
<p>Apple TV上所有的视频回放都基于 HTTP Live Streaming 和 FairPlay Streaming。请查看 HTTP Live Streaming 和 FairPlay Streaming Overview。关于HTTP Live Streaming 编写规范，请查阅 HLS Authoring Specification for Apple TV。</p>
<h6 id="Top-Shelf"><a href="#Top-Shelf" class="headerlink" title="Top Shelf"></a>Top Shelf</h6><p>用户可以将任何 Apple TV app放在 App菜单的顶行，最多能放5个 icon。用户在顶行选中某个 icon 时，屏幕顶部会展示与该 APP 相关的内容，这个区域被称为 Top Shelf。在这个区域展示 APP 的内容，可以让用户预览他们关心的内容，或者让他们直接跳转至 APP 的特定部分。</p>
<h6 id="焦点和视差图片"><a href="#焦点和视差图片" class="headerlink" title="焦点和视差图片"></a>焦点和视差图片</h6><p>当用户停留在某个项目上但却没有选择该项目时，某个UI元素就处于聚焦状态。当用户聚焦到一个分层图片上时，图片会响应用户在遥控器玻璃材质触控板上的触摸。</p>
<p>每层图片以稍有不同的速度旋转以产生视察效果。这种精细的效果为用户创造了视觉上的深度，更现实也更有活力，并强调被聚焦的图片正是用户想要的。</p>
<p>视差图片由设计师完成。但是如何将其应用在你的APP中呢？改进后的 UIImageView 可以支持视差图片，所以大多数情况下你只需做很小的编码调整。根据是要将图片直接添加到APP，还是在运行时从服务器加载，你的工作也会有所变化。</p>
<h6 id="新的-tvOS-框架"><a href="#新的-tvOS-框架" class="headerlink" title="新的 tvOS 框架"></a>新的 tvOS 框架</h6><p>Apple tvOS 引入了 tvOS 专有的新框架：</p>
<ul>
<li>TVMLJS：描述了用于加载 TVML 页面（在C-S APP中展示信息）的JavaScript API。详见 TVJS Framework Reference.\</li>
<li>TVMLKit：提供了将 JavaScript 和 TVML 元素包含进你的 APP 的方法。详见TVMLKit Framework Reference.</li>
<li>TVServices：描述如何为 APP 添加一个 top shelf 扩展。详见 TVServices Framework Reference.</li>
</ul>
<h6 id="继承-iOS-框架"><a href="#继承-iOS-框架" class="headerlink" title="继承 iOS 框架"></a>继承 iOS 框架</h6><p>Apple tvOS 继承了 iOS 的一些框架。详见 iOS 框架和 tvOS 框架之间一些小差异。</p>
<ul>
<li>Accelerate</li>
<li>AudioToolbox</li>
<li>AudioUnit</li>
<li>AVFoundation</li>
<li>AVKit</li>
<li>CFNetwork</li>
<li>CloudKit</li>
<li>CoreBluetooth</li>
<li>CoreData</li>
<li>CoreFoundation</li>
<li>CoreGraphics</li>
<li>CoreImage</li>
<li>CoreLocation</li>
<li>CoreMedia</li>
<li>CoreSpotlight</li>
<li>CoreText</li>
<li>CoreVideo</li>
<li>Darwin</li>
<li>Foundation</li>
<li>GameController</li>
<li>GameKit</li>
<li>GameplayKit</li>
<li>GLKit</li>
<li>ImageIO</li>
<li>MachO</li>
<li>MediaAccessibility</li>
<li>MediaPlayer</li>
<li>MediaToolbox</li>
<li>Metal</li>
<li>MetalKit</li>
<li>MetalPerformanceShaders</li>
<li>MobileCoreServices</li>
<li>ModelIO</li>
<li>OpenGLES</li>
<li>SceneKit</li>
<li>Security</li>
<li>simd</li>
<li>SpriteKit</li>
<li>StoreKit</li>
<li>Swift Standard Library</li>
<li>SystemConfiguration</li>
<li>UIKit</li>
</ul>
<h6 id="新用户界面挑战"><a href="#新用户界面挑战" class="headerlink" title="新用户界面挑战"></a>新用户界面挑战</h6><p>Apple TV 没有鼠标来让用户直接选择 APP 或者与之进行交互，也不能触摸和使用手势。相反，Apple TV 使用了 Siri Remote 或者游戏控制器在屏幕上进行移动。</p>
<p>除了新控制器，整个用户体验也是完全不同。Mac 和 iOS 设备通常是单人体验。用户可能在你的 APP 中进行其他交互操作，但用户依然是一个人使用设备。对于新Apple TV，用户体验变得更加社交化。可能会有几个人坐在沙发上与你的 APP 进行交互。对于一款优秀的 APP 来说，利用这些变化是至关重要的。</p>
<h6 id="APP本地储存有限"><a href="#APP本地储存有限" class="headerlink" title="APP本地储存有限"></a>APP本地储存有限</h6><p>Apple TV app 最大容量为 200MB。此外，你的 APP 最多可使用该设备本地 500KB 的永久存储（使用 NSUserDefaults 类）。</p>
<p>除了有限的本地存储，在空间不够的情况下，其他所有数据必须可由操作系统清除。对于这些资源的管理，你有以下几个选择：</p>
<p>你的 APP 可以在iCloud服务中存储和检索用户数据。</p>
<p>你的 APP 将所需数据下载到它的缓存目录中。当 APP 运行时下载的数据不会被删除。不过，当空间不足并且你的 APP 没有运行时，这些数据可能会被删除。不要使用整个缓存空间，这样会导致不可预知的后果。</p>
<p>你的 APP 可以使用 on-demand resources 打包只读资产。在运行时，APP 会根据需要请求资源，并且操作系统会自动下载和管理这些资源。知道如何以及何时加载新资产而又保持用户的参与非常关键。关于 on-demand resources 的更多信息，请参看 On-Demand Resources Guide。</p>
<p>这意味着为新 Apple TV 开发的每款应用程序都必须能在 iCloud 储存和检索数据，以提供良好的用户体验。</p>
<p>以 Apple TV 作为目标平台</p>
<p>当你需要编写仅适用于 tvOS 的代码时，可使用 #define TARGET_OS_TV 1 宏。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">&lt;i class&#x3D;&quot;fa fa-angle-right&quot;&gt;&lt;&#x2F;i&gt;</a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name"></p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives">
              
                  <span class="site-state-item-count">13</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                
                  <span class="site-state-item-count">3</span>
                  <span class="site-state-item-name">categories</span>
                
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">6</span>
                  <span class="site-state-item-name">tags</span>
                
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">John Doe</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
